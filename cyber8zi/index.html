<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta content="initial-scale=1, minimum-scale=1, width=device-width" name="viewport">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3750932727344358" crossorigin="anonymous"></script>

    <meta name="author" content="Jakevin 羅旭辰" />
    <meta name="publisher" content="Jakevin 羅旭辰" />
    <meta name="company" content="北科大工工所" />

    <meta name="rating" content="general" />
    <meta name="copyright" content="&copy; Jakevin Lo" />
    <meta name="robots" content="all" />
    <meta name="spiders" content="all" />
    <meta name="webcrawlers" content="all" />
    <meta name="theme-color" content="#0085d5">
    <meta name="abstract" content="賽博八字算命| Cyber Fortune Telling" />
    <meta name="subject" content="賽博八字算命| Cyber Fortune Telling" />
    <meta name="description" content="賽博八字算命| Cyber Fortune Telling" />
    <meta name="keywords" content="北科大, TTI, AI, FLUX, GPT" />
    <meta property="og:site_name" content="Jakevin" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="賽博八字算命| Cyber Fortune Telling" />
    <meta property="og:url" content="https://jakevin.github.io/" />
    <meta property="og:description" content="賽博八字算命| Cyber Fortune Telling" />
    <meta property="og:image"
        content="https://api.together.ai/imgproxy/pXOo77HixdTIUEFb39BSE0_szy_9bn6i9y-uP5kFH5g/format:jpg/aHR0cHM6Ly90b2dldGhlci1haS1iZmwtaW1hZ2VzLXByb2QuczMudXMtd2VzdC0yLmFtYXpvbmF3cy5jb20vaW1hZ2VzLzk0OGRjMzBkYmM2MDBmNzRhZWZmMGU0ZmUwMDM1ZjhjNTFjNGRlYTNhNWY5MGFkNzM0NzBlNzQxZDIyOWYwNmQ_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ29udGVudC1TaGEyNTY9VU5TSUdORUQtUEFZTE9BRCZYLUFtei1DcmVkZW50aWFsPUFTSUFZV1pXNEhWQ0FUV1Q3SlJIJTJGMjAyNDEwMDglMkZ1cy13ZXN0LTIlMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQxMDA4VDE2MDAxOVomWC1BbXotRXhwaXJlcz0zNjAwJlgtQW16LVNlY3VyaXR5LVRva2VuPUlRb0piM0pwWjJsdVgyVmpFUEQlMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkZ3RWFDWFZ6TFhkbGMzUXRNaUpHTUVRQ0lEd2dydUNUOVdZOFpSSUFHV2dSRXR4TFZrJTJCdWg4R3ZaUyUyQjVZczNDSUFZdUFpQnUxNWkzeWxmNzFFJTJGb0x6WFAlMkJRWkpaa0RldVhZQWI2QlJCJTJCMSUyRmtSUHczeXFRQlFoSkVBQWFERFU1T0RjeU5qRTJNemM0TUNJTXhBUiUyQlRhWUtPejlyMWxEYkt1MEUwJTJCbUM1UzNtQlY0Q0daeWowJTJGR0hUZ1J1cyUyRkVJYVk0UXh4c2V6dGwyNHBqeVlMZDhJWHZueGdVVVJuYnNFZ0lFaldac3ViZ1lONyUyQnl3TGV0MUJkcCUyQiUyQnNnTmZ3Y1pSOTkzN0NickRTbGVpODB0cDdyb3cwT2hTd2x1QTNIM3BpakFzRElkSzNqaWR2Z2hNWkFYUkolMkYyUndSUHZPaHlseEU2b2toS2IyMGRKekhEUzNRRlRVRG5jZGpNJTJGaWoyZmV1MFN6VDhBd1RZQWNBaFJGaEo3ViUyQnFvMElyZ2ZRRVV6RmNSSEhmVTlzb3hkUjZYQUUxdSUyQndBb3htOUVJNllqT2NNckVPNzFjSHRjd0IwV3FnJTJGNThlbnoyOEZMdlUlMkZYY3RSS2F6dm9zUHNMcGdHamJLeXc3b3hTJTJGSFAlMkZFb2haVTBzZUhGZVBRdXlKcTg5dHNHQnU5RmJpNUVyekg4amxHNGtMMmQ3RTJwNFFETm11RHNiR2tmTGRLY1EyZSUyQkUlMkZrR1M3MWNJVjNkU0FNRERmMmpPcUdUcUtVa3dCZVElMkJuNndnaWZ3cGEybnpvak5hcGFRbFhQNThUbkpBQSUyQk83U3QzU0dSYkdQQm1tZFRIJTJGenFRZ2tjTTBDRVNqMzNSTEZLTjJWOU1mTXFxakkzJTJCRGJtYm1SbVBSc0NoY2ZPNnNjaFJiNlJOdiUyQmZIczU2M0ZDZkgzNjNJeVNtNEx3Yk54TlFncENVMGdDeEI0dEFOMmo4ck9xemJSVmMyJTJCVVhqYW10VCUyQnF0SmtBOWxXaTNaUTZRazlXTU9hanJqdnQxSmhnY2VrQlN0TXklMkZUaGd5QjhaWUEyclBpczdKRk41ZVY1JTJCOUo4TmdGNGh3Z044U05jSTZtJTJGQXNhb1dvSUNPV1NSb1NsRHViQ0Z5UVVvSFlHMUwlMkJGNEpxczlKS1RrOE9JRDUlMkJlNDFSeDQ2TW9HY1k5ZHBwVmVUNVhtdkdlS2xoNGhKNG5LS0xzN3R0bGJFZFVnYjMlMkJMVGkzdmNEdXNRSmE5ZUxDJTJCczQlMkJNWXc2Tzg3NDZ6NktoSTRnb1hReUQxMHZEejFKYUFsdXdjWDdQJTJGdVBUSEdWd0pnV3hrQ0hhN2w5TUpPdWxiZ0dPcHdCQVhUVGZNRHVITDVtNU5nRVdtTmd4JTJCUmNic1hOcUMzUDFKdWZnOGVJT1lsU1lSVklVZFJLODlzVHJHa3dZU0JzNUJNSnlkalJTQnBJeUxjdnppVk1PWWFGZExiZVAlMkZJZmJZTXRFeno0STh0WnBycUpFeWJScDZ2R21vUTNIWSUyRlBoWlolMkZWR2lMQkY3NGYxV1hUYnBobnp1VjVRTXRkcTMzclNleWhwVHNlYjJwRHhKcSUyRnYwNDQ5T0N2dHo5NTZiMWlCejh5OGtLbDB4M3N3cDcmWC1BbXotU2lnbmF0dXJlPWViZDU4NDU1ODg0OTM0M2ZiNDdjMmMwMDg5MzU0ZjIxYjViYmVmOGY5NDhjOTI3ZjcyMDJjMmE4ODkzMzgxOGUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JngtaWQ9R2V0T2JqZWN0" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@Jakevin16" />
    <meta name="twitter:title" content="賽博八字算命| Cyber Fortune Telling" />
    <meta name="twitter:url" content="https://jakevin.github.io/" />
    <meta name="twitter:description" content="賽博八字算命| Cyber Fortune Telling" />
    <meta name="twitter:image:src"
        content="https://api.together.ai/imgproxy/pXOo77HixdTIUEFb39BSE0_szy_9bn6i9y-uP5kFH5g/format:jpg/aHR0cHM6Ly90b2dldGhlci1haS1iZmwtaW1hZ2VzLXByb2QuczMudXMtd2VzdC0yLmFtYXpvbmF3cy5jb20vaW1hZ2VzLzk0OGRjMzBkYmM2MDBmNzRhZWZmMGU0ZmUwMDM1ZjhjNTFjNGRlYTNhNWY5MGFkNzM0NzBlNzQxZDIyOWYwNmQ_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ29udGVudC1TaGEyNTY9VU5TSUdORUQtUEFZTE9BRCZYLUFtei1DcmVkZW50aWFsPUFTSUFZV1pXNEhWQ0FUV1Q3SlJIJTJGMjAyNDEwMDglMkZ1cy13ZXN0LTIlMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQxMDA4VDE2MDAxOVomWC1BbXotRXhwaXJlcz0zNjAwJlgtQW16LVNlY3VyaXR5LVRva2VuPUlRb0piM0pwWjJsdVgyVmpFUEQlMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkZ3RWFDWFZ6TFhkbGMzUXRNaUpHTUVRQ0lEd2dydUNUOVdZOFpSSUFHV2dSRXR4TFZrJTJCdWg4R3ZaUyUyQjVZczNDSUFZdUFpQnUxNWkzeWxmNzFFJTJGb0x6WFAlMkJRWkpaa0RldVhZQWI2QlJCJTJCMSUyRmtSUHczeXFRQlFoSkVBQWFERFU1T0RjeU5qRTJNemM0TUNJTXhBUiUyQlRhWUtPejlyMWxEYkt1MEUwJTJCbUM1UzNtQlY0Q0daeWowJTJGR0hUZ1J1cyUyRkVJYVk0UXh4c2V6dGwyNHBqeVlMZDhJWHZueGdVVVJuYnNFZ0lFaldac3ViZ1lONyUyQnl3TGV0MUJkcCUyQiUyQnNnTmZ3Y1pSOTkzN0NickRTbGVpODB0cDdyb3cwT2hTd2x1QTNIM3BpakFzRElkSzNqaWR2Z2hNWkFYUkolMkYyUndSUHZPaHlseEU2b2toS2IyMGRKekhEUzNRRlRVRG5jZGpNJTJGaWoyZmV1MFN6VDhBd1RZQWNBaFJGaEo3ViUyQnFvMElyZ2ZRRVV6RmNSSEhmVTlzb3hkUjZYQUUxdSUyQndBb3htOUVJNllqT2NNckVPNzFjSHRjd0IwV3FnJTJGNThlbnoyOEZMdlUlMkZYY3RSS2F6dm9zUHNMcGdHamJLeXc3b3hTJTJGSFAlMkZFb2haVTBzZUhGZVBRdXlKcTg5dHNHQnU5RmJpNUVyekg4amxHNGtMMmQ3RTJwNFFETm11RHNiR2tmTGRLY1EyZSUyQkUlMkZrR1M3MWNJVjNkU0FNRERmMmpPcUdUcUtVa3dCZVElMkJuNndnaWZ3cGEybnpvak5hcGFRbFhQNThUbkpBQSUyQk83U3QzU0dSYkdQQm1tZFRIJTJGenFRZ2tjTTBDRVNqMzNSTEZLTjJWOU1mTXFxakkzJTJCRGJtYm1SbVBSc0NoY2ZPNnNjaFJiNlJOdiUyQmZIczU2M0ZDZkgzNjNJeVNtNEx3Yk54TlFncENVMGdDeEI0dEFOMmo4ck9xemJSVmMyJTJCVVhqYW10VCUyQnF0SmtBOWxXaTNaUTZRazlXTU9hanJqdnQxSmhnY2VrQlN0TXklMkZUaGd5QjhaWUEyclBpczdKRk41ZVY1JTJCOUo4TmdGNGh3Z044U05jSTZtJTJGQXNhb1dvSUNPV1NSb1NsRHViQ0Z5UVVvSFlHMUwlMkJGNEpxczlKS1RrOE9JRDUlMkJlNDFSeDQ2TW9HY1k5ZHBwVmVUNVhtdkdlS2xoNGhKNG5LS0xzN3R0bGJFZFVnYjMlMkJMVGkzdmNEdXNRSmE5ZUxDJTJCczQlMkJNWXc2Tzg3NDZ6NktoSTRnb1hReUQxMHZEejFKYUFsdXdjWDdQJTJGdVBUSEdWd0pnV3hrQ0hhN2w5TUpPdWxiZ0dPcHdCQVhUVGZNRHVITDVtNU5nRVdtTmd4JTJCUmNic1hOcUMzUDFKdWZnOGVJT1lsU1lSVklVZFJLODlzVHJHa3dZU0JzNUJNSnlkalJTQnBJeUxjdnppVk1PWWFGZExiZVAlMkZJZmJZTXRFeno0STh0WnBycUpFeWJScDZ2R21vUTNIWSUyRlBoWlolMkZWR2lMQkY3NGYxV1hUYnBobnp1VjVRTXRkcTMzclNleWhwVHNlYjJwRHhKcSUyRnYwNDQ5T0N2dHo5NTZiMWlCejh5OGtLbDB4M3N3cDcmWC1BbXotU2lnbmF0dXJlPWViZDU4NDU1ODg0OTM0M2ZiNDdjMmMwMDg5MzU0ZjIxYjViYmVmOGY5NDhjOTI3ZjcyMDJjMmE4ODkzMzgxOGUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JngtaWQ9R2V0T2JqZWN0" />
    <title>賽博八字算命</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lunisolar-full@2.4.0-4/dist/lunisolar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/iztro/dist/iztro.min.js"></script>

    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            padding: 0;
            background-color: #f4f4f4;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        input[type="number"],
        input[type="time"],
        select,
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .date-group {
            display: flex;
            gap: 10px;
        }

        .date-group input {
            width: 33%;
        }

        .radio-group {
            display: flex;
            gap: 20px;
        }

        .radio-group label {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        input[type="radio"] {
            margin: 0;
        }

        #generate-btn {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
        }

        #generate-btn:hover {
            background-color: #0056b3;
        }

        #error-message {
            color: red;
            margin-top: 10px;
            display: none;
        }

        .tab-container {
            margin-top: 20px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .tab-button {
            padding: 10px 20px;
            border: none;
            background-color: #f0f0f0;
            cursor: pointer;
            border-radius: 4px 4px 0 0;
            font-size: 16px;
        }

        .tab-button.active {
            background-color: #007bff;
            color: white;
        }

        .tab-content {
            display: none;
            background-color: #fff;
            /* padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px; */
        }

        .tab-content.active {
            display: block;
        }

        pre {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            position: relative;
        }

        .form-section {
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }

        .form-section:last-child {
            border-bottom: none;
        }

        .copy-btn {
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .copy-btn:hover {
            background-color: #0056b3;
        }

        #svgOutput {
            border: 1px solid #ddd;
            padding: 15px;
            line-height: 1.6;
        }

        #svgOutput code {
            background-color: #f5f5f5;
            padding: 2px 4px;
            border-radius: 4px;
            font-family: monospace;
        }

        #svgOutput pre {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }

        #svgOutput pre code {
            background-color: transparent;
            padding: 0;
        }

        #svgOutput blockquote {
            border-left: 4px solid #ddd;
            padding-left: 15px;
            margin-left: 0;
            color: #666;
        }

        #svgOutput h1,
        #svgOutput h2,
        #svgOutput h3,
        #svgOutput h4 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
        }

        #svgOutput ul,
        #svgOutput ol {
            padding-left: 20px;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .progress-bar {
            width: 80%;
            max-width: 500px;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar-inner {
            width: 100%;
            height: 100%;
            background-color: #4CAF50;
            animation: progress 2s infinite linear;
            transform-origin: left;
        }

        @keyframes progress {
            0% {
                transform: scaleX(0);
            }

            50% {
                transform: scaleX(1);
            }

            100% {
                transform: scaleX(0);
            }
        }
    </style>
</head>

<body>
    <div class="loading-overlay">
        <div class="progress-bar">
            <div class="progress-bar-inner"></div>
        </div>
    </div>
    <div class="container">
        <h1>賽博八字算命綜合分析 + Prompt生成器</h1>

        <div class="form-section">
            <label>性別:</label>
            <div class="radio-group">
                <label><input type="radio" name="gender" value="男" required> 男</label>
                <label><input type="radio" name="gender" value="女" required> 女</label>
            </div>

        </div>
        <div class="form-section">
            <label>出生日期 (陽曆):</label>
            <div class="date-group">
                <input type="datetime-local" id="datetime" style="width: 300px" step="1">
            </div>
            <div id="true-solar-time" style="margin-top: 10px; padding: 10px; background-color: #e8f5e9; border-radius: 4px; display: none;">
                <strong>真太陽時：</strong> <span id="solar-time-result"></span>
            </div>
        </div>
        <div class="form-section">
            <label for="province">出生地:</label>
            <select id="province" required>
                <option value="台灣">台灣</option>
            </select>

            <label for="city">出生城市:</label>
            <select id="city" required>
                <option value="">-- 請選擇 --</option>
            </select>

            <p style="margin-top: 10px; padding: 10px; background-color: #f5dddd; border-radius: 4px;">
                重要宣告：</br>
                八字命理是一種複雜的學問僅供參考，不能作為決策的唯一依據。
            </p>
        </div>


        <button id="generate-btn">請幫我算一算！</button>
        <div id="error-message"></div>
        <div id="result-layout" class="tab-container" style="display: none;">
            <div class="tab-buttons">
                <button class="tab-button " onclick="switchTab('result')">AI解盤</button>
                <button class="tab-button active" onclick="switchTab('prompt')">Prompt</button>
            </div>
            <div id="result-tab" class="tab-content ">
                <div id="svgOutput"></div>
            </div>
            <div id="prompt-tab" class="tab-content active">
                <div style="margin-top: 10px; padding: 10px; background-color: #e8f5e9; border-radius: 4px;">請把內容複製後，貼給ChatGPT</div>
                <pre id="output">
                    <button class="copy-btn" onclick="copyPrompt()">複製</button>
                </pre>
            </div>
        </div>
        <div>
            <p>本工具使用 <a href="https://lunisolar.js.org/" target="_blank">lunisolar</a> 作為天干地支的轉換工具</p>
            <p>本工具使用 <a href="https://lunisolar.js.org/" target="_blank">iztro</a> 作為紫微斗數的轉換工具</p>
        </div>
    </div>

    <script>


        document.addEventListener('DOMContentLoaded', function () {
            const datetimeInput = document.getElementById('datetime');
            const provinceSelect = document.getElementById('province');
            const citySelect = document.getElementById('city');
            const genderRadios = document.getElementsByName('gender');
            const generateBtn = document.getElementById('generate-btn');
            const errorMessage = document.getElementById('error-message');
            const resultLayout = document.getElementById('result-layout');
            const outputDiv = document.getElementById('output');
            const svgOutput = document.getElementById('svgOutput');

            const locationData = {
                "台灣": {
                    "台北市": { longitude: 121.5 },
                    "台中市": { longitude: 120.9 },
                    "新北市": { longitude: 121.5 },
                    "桃園市": { longitude: 121.2 },
                    "基隆市": { longitude: 121.7 },
                    "新竹": { longitude: 121.1 },
                    "苗栗": { longitude: 120.9 },
                    "彰化": { longitude: 120.5 },
                    "南投": { longitude: 120.7 },
                    "雲林": { longitude: 120.4 },
                    "嘉義": { longitude: 120.4 },
                    "台南市": { longitude: 120.5 },
                    "高雄市": { longitude: 120.5 },
                    "屏東": { longitude: 120.2 },
                    "宜蘭": { longitude: 121.3 },
                    "花蓮": { longitude: 121.1 },
                    "台東": { longitude: 121.0 },
                    "澎湖": { longitude: 119.6 },
                    "金門": { longitude: 118.6 },
                    "連江": { longitude: 120.0 }
                },
                "北京市": { "北京市": { longitude: 116.4 } },
                "天津市": { "天津市": { longitude: 117.2 } },
                "河北省": {
                    "石家庄市": { longitude: 114.5 },
                    "唐山市": { longitude: 118.2 },
                    "秦皇岛市": { longitude: 119.6 },
                    "邯郸市": { longitude: 114.5 },
                    "邢台市": { longitude: 114.5 },
                    "保定市": { longitude: 115.5 },
                    "张家口市": { longitude: 114.9 },
                    "承德市": { longitude: 117.9 },
                    "沧州市": { longitude: 116.8 },
                    "廊坊市": { longitude: 116.7 },
                    "衡水市": { longitude: 115.7 }
                },
                "山西省": {
                    "太原市": { longitude: 112.5 },
                    "大同市": { longitude: 113.3 },
                    "阳泉市": { longitude: 113.6 },
                    "长治市": { longitude: 113.1 },
                    "晋城市": { longitude: 112.8 },
                    "朔州市": { longitude: 112.4 },
                    "晋中市": { longitude: 112.7 },
                    "运城市": { longitude: 111.0 },
                    "忻州市": { longitude: 112.7 },
                    "临汾市": { longitude: 111.5 },
                    "吕梁市": { longitude: 111.1 }
                },
                "内蒙古自治区": {
                    "呼和浩特市": { longitude: 111.7 },
                    "包头市": { longitude: 110.0 },
                    "乌海市": { longitude: 118.3 },
                    "赤峰市": { longitude: 118.9 },
                    "通辽市": { longitude: 122.2 },
                    "鄂尔多斯市": { longitude: 109.8 },
                    "呼伦贝尔市": { longitude: 119.7 },
                    "巴彦淖尔市": { longitude: 107.4 },
                    "乌兰察布市": { longitude: 113.2 },
                    "兴安盟": { longitude: 122.1 },
                    "锡林郭勒盟": { longitude: 116.0 },
                    "阿拉善盟": { longitude: 105.7 }
                },
                "辽宁省": {
                    "沈阳市": { longitude: 123.4 },
                    "大连市": { longitude: 121.6 },
                    "鞍山市": { longitude: 122.9 },
                    "抚顺市": { longitude: 123.9 },
                    "本溪市": { longitude: 123.7 },
                    "丹东市": { longitude: 124.3 },
                    "锦州市": { longitude: 121.1 },
                    "营口市": { longitude: 122.2 },
                    "阜新市": { longitude: 121.6 },
                    "辽阳市": { longitude: 123.2 },
                    "盘锦市": { longitude: 122.0 },
                    "铁岭市": { longitude: 123.8 },
                    "朝阳市": { longitude: 120.4 },
                    "葫芦岛市": { longitude: 120.8 }
                },
                "吉林省": {
                    "长春市": { longitude: 125.3 },
                    "吉林市": { longitude: 126.5 },
                    "四平市": { longitude: 124.3 },
                    "辽源市": { longitude: 125.1 },
                    "通化市": { longitude: 125.9 },
                    "白山市": { longitude: 126.4 },
                    "松原市": { longitude: 124.8 },
                    "白城市": { longitude: 122.8 },
                    "延边朝鲜族自治州": { longitude: 129.5 }
                },
                "黑龙江省": {
                    "哈尔滨市": { longitude: 126.6 },
                    "齐齐哈尔市": { longitude: 123.9 },
                    "鸡西市": { longitude: 130.9 },
                    "鹤岗市": { longitude: 130.3 },
                    "双鸭山市": { longitude: 131.1 },
                    "大庆市": { longitude: 125.1 },
                    "伊春市": { longitude: 129.0 },
                    "佳木斯市": { longitude: 130.3 },
                    "七台河市": { longitude: 130.9 },
                    "牡丹江市": { longitude: 129.6 },
                    "黑河市": { longitude: 127.5 },
                    "绥化市": { longitude: 126.9 },
                    "大兴安岭地区": { longitude: 124.7 }
                },
                "上海市": { "上海市": { longitude: 121.4 } },
                "江苏省": {
                    "南京市": { longitude: 118.8 },
                    "无锡市": { longitude: 120.3 },
                    "徐州市": { longitude: 117.2 },
                    "常州市": { longitude: 119.9 },
                    "苏州市": { longitude: 120.6 },
                    "南通市": { longitude: 120.8 },
                    "连云港市": { longitude: 119.2 },
                    "淮安市": { longitude: 119.0 },
                    "盐城市": { longitude: 120.1 },
                    "扬州市": { longitude: 119.4 },
                    "镇江市": { longitude: 119.4 },
                    "泰州市": { longitude: 119.9 },
                    "宿迁市": { longitude: 118.3 }
                },
                "浙江省": {
                    "杭州市": { longitude: 120.2 },
                    "宁波市": { longitude: 121.5 },
                    "温州市": { longitude: 120.6 },
                    "嘉兴市": { longitude: 120.7 },
                    "湖州市": { longitude: 120.1 },
                    "绍兴市": { longitude: 120.5 },
                    "金华市": { longitude: 119.6 },
                    "衢州市": { longitude: 118.8 },
                    "舟山市": { longitude: 122.3 },
                    "台州市": { longitude: 121.4 },
                    "丽水市": { longitude: 119.9 }
                },
                "安徽省": {
                    "合肥市": { longitude: 117.3 },
                    "芜湖市": { longitude: 118.3 },
                    "蚌埠市": { longitude: 117.3 },
                    "淮南市": { longitude: 116.7 },
                    "马鞍山市": { longitude: 118.5 },
                    "淮北市": { longitude: 116.8 },
                    "铜陵市": { longitude: 117.8 },
                    "安庆市": { longitude: 117.0 },
                    "黄山市": { longitude: 118.3 },
                    "滁州市": { longitude: 118.3 },
                    "阜阳市": { longitude: 115.8 },
                    "宿州市": { longitude: 116.9 },
                    "六安市": { longitude: 116.5 },
                    "亳州市": { longitude: 115.7 },
                    "池州市": { longitude: 117.4 },
                    "宣城市": { longitude: 118.7 }
                },
                "福建省": {
                    "福州市": { longitude: 119.3 },
                    "厦门市": { longitude: 118.1 },
                    "莆田市": { longitude: 119.0 },
                    "三明市": { longitude: 117.6 },
                    "泉州市": { longitude: 118.6 },
                    "漳州市": { longitude: 117.6 },
                    "南平市": { longitude: 118.0 },
                    "龙岩市": { longitude: 117.0 },
                    "宁德市": { longitude: 119.5 }
                },
                "江西省": {
                    "南昌市": { longitude: 115.9 },
                    "景德镇市": { longitude: 117.2 },
                    "萍乡市": { longitude: 113.8 },
                    "九江市": { longitude: 116.0 },
                    "新余市": { longitude: 114.9 },
                    "鹰潭市": { longitude: 117.0 },
                    "赣州市": { longitude: 114.9 },
                    "宜春市": { longitude: 114.4 },
                    "上饶市": { longitude: 117.9 },
                    "吉安市": { longitude: 114.9 },
                    "抚州市": { longitude: 116.3 }
                },
                "山东省": {
                    "济南市": { longitude: 117.0 },
                    "青岛市": { longitude: 120.3 },
                    "淄博市": { longitude: 118.0 },
                    "枣庄市": { longitude: 117.5 },
                    "东营市": { longitude: 118.5 },
                    "烟台市": { longitude: 121.4 },
                    "潍坊市": { longitude: 119.1 },
                    "济宁市": { longitude: 116.5 },
                    "泰安市": { longitude: 117.1 },
                    "威海市": { longitude: 122.1 },
                    "日照市": { longitude: 119.5 },
                    "滨州市": { longitude: 118.0 },
                    "德州市": { longitude: 116.3 },
                    "聊城市": { longitude: 115.9 },
                    "临沂市": { longitude: 118.3 },
                    "菏泽市": { longitude: 115.4 }
                },
                "河南省": {
                    "郑州市": { longitude: 113.6 },
                    "开封市": { longitude: 114.3 },
                    "洛阳市": { longitude: 112.4 },
                    "平顶山市": { longitude: 113.3 },
                    "安阳市": { longitude: 114.3 },
                    "鹤壁市": { longitude: 114.3 },
                    "新乡市": { longitude: 113.9 },
                    "焦作市": { longitude: 113.2 },
                    "濮阳市": { longitude: 115.0 },
                    "许昌市": { longitude: 113.8 },
                    "漯河市": { longitude: 114.0 },
                    "三门峡市": { longitude: 111.9 },
                    "南阳市": { longitude: 112.5 },
                    "商丘市": { longitude: 115.6 },
                    "信阳市": { longitude: 114.0 },
                    "周口市": { longitude: 114.6 },
                    "驻马店市": { longitude: 114.0 },
                    "济源市": { longitude: 112.6 }
                },
                "湖北省": {
                    "武汉市": { longitude: 114.3 },
                    "黄石市": { longitude: 114.9 },
                    "十堰市": { longitude: 110.7 },
                    "宜昌市": { longitude: 111.3 },
                    "襄阳市": { longitude: 112.1 },
                    "鄂州市": { longitude: 114.8 },
                    "荆门市": { longitude: 112.2 },
                    "孝感市": { longitude: 113.9 },
                    "荆州市": { longitude: 112.2 },
                    "黄冈市": { longitude: 114.8 },
                    "咸宁市": { longitude: 114.3 },
                    "随州市": { longitude: 113.3 },
                    "恩施土家族苗族自治州": { longitude: 109.4 },
                    "仙桃市": { longitude: 113.4 },
                    "潜江市": { longitude: 112.9 },
                    "天门市": { longitude: 113.1 },
                    "神农架林区": { longitude: 110.3 }
                },
                "湖南省": {
                    "长沙市": { longitude: 113.0 },
                    "株洲市": { longitude: 113.1 },
                    "湘潭市": { longitude: 112.9 },
                    "衡阳市": { longitude: 112.6 },
                    "邵阳市": { longitude: 111.4 },
                    "岳阳市": { longitude: 113.1 },
                    "常德市": { longitude: 111.6 },
                    "张家界市": { longitude: 110.4 },
                    "益阳市": { longitude: 112.3 },
                    "郴州市": { longitude: 113.0 },
                    "永州市": { longitude: 111.6 },
                    "怀化市": { longitude: 110.0 },
                    "娄底市": { longitude: 112.0 },
                    "湘西土家族苗族自治州": { longitude: 109.7 }
                },
                "广东省": {
                    "广州市": { longitude: 113.2 },
                    "韶关市": { longitude: 113.6 },
                    "深圳市": { longitude: 114.0 },
                    "珠海市": { longitude: 113.5 },
                    "汕头市": { longitude: 116.6 },
                    "佛山市": { longitude: 113.1 },
                    "江门市": { longitude: 113.0 },
                    "湛江市": { longitude: 110.3 },
                    "茂名市": { longitude: 110.8 },
                    "肇庆市": { longitude: 112.4 },
                    "惠州市": { longitude: 114.4 },
                    "梅州市": { longitude: 116.1 },
                    "汕尾市": { longitude: 115.3 },
                    "河源市": { longitude: 114.6 },
                    "阳江市": { longitude: 111.9 },
                    "清远市": { longitude: 113.0 },
                    "东莞市": { longitude: 113.7 },
                    "中山市": { longitude: 113.3 },
                    "潮州市": { longitude: 116.6 },
                    "揭阳市": { longitude: 116.3 },
                    "云浮市": { longitude: 112.0 }
                },
                "广西壮族自治区": {
                    "南宁市": { longitude: 108.3 },
                    "柳州市": { longitude: 109.4 },
                    "桂林市": { longitude: 110.2 },
                    "梧州市": { longitude: 111.3 },
                    "北海市": { longitude: 109.1 },
                    "防城港市": { longitude: 108.3 },
                    "钦州市": { longitude: 108.6 },
                    "贵港市": { longitude: 109.5 },
                    "玉林市": { longitude: 110.1 },
                    "百色市": { longitude: 106.6 },
                    "贺州市": { longitude: 111.5 },
                    "河池市": { longitude: 107.9 },
                    "来宾市": { longitude: 109.2 },
                    "崇左市": { longitude: 107.3 }
                },
                "海南省": {
                    "海口市": { longitude: 110.3 },
                    "三亚市": { longitude: 109.5 },
                    "三沙市": { longitude: 112.3 },
                    "儋州市": { longitude: 109.5 },
                    "文昌市": { longitude: 110.7 },
                    "琼海市": { longitude: 110.4 },
                    "万宁市": { longitude: 110.4 },
                    "五指山市": { longitude: 109.5 },
                    "东方市": { longitude: 108.6 },
                    "定安县": { longitude: 110.3 },
                    "屯昌县": { longitude: 109.9 },
                    "澄迈县": { longitude: 110.0 },
                    "临高县": { longitude: 109.7 },
                    "白沙黎族自治县": { longitude: 109.4 },
                    "昌江黎族自治县": { longitude: 109.0 },
                    "乐东黎族自治县": { longitude: 109.1 },
                    "陵水黎族自治县": { longitude: 110.0 },
                    "保亭黎族苗族自治县": { longitude: 109.7 },
                    "琼中黎族苗族自治县": { longitude: 109.8 }
                },
                "重庆市": { "重庆市": { longitude: 106.5 } },
                "四川省": {
                    "成都市": { longitude: 104.0 },
                    "自贡市": { longitude: 104.7 },
                    "攀枝花市": { longitude: 101.7 },
                    "泸州市": { longitude: 105.4 },
                    "德阳市": { longitude: 104.3 },
                    "绵阳市": { longitude: 104.7 },
                    "广元市": { longitude: 105.8 },
                    "遂宁市": { longitude: 105.5 },
                    "内江市": { longitude: 105.0 },
                    "乐山市": { longitude: 103.7 },
                    "南充市": { longitude: 106.1 },
                    "眉山市": { longitude: 103.8 },
                    "宜宾市": { longitude: 104.5 },
                    "广安市": { longitude: 106.6 },
                    "达州市": { longitude: 107.5 },
                    "雅安市": { longitude: 103.0 },
                    "巴中市": { longitude: 106.7 },
                    "资阳市": { longitude: 104.9 },
                    "阿坝藏族羌族自治州": { longitude: 102.2 },
                    "甘孜藏族自治州": { longitude: 101.9 },
                    "凉山彝族自治州": { longitude: 102.2 }
                },
                "贵州省": {
                    "贵阳市": { longitude: 106.7 },
                    "六盘水市": { longitude: 104.8 },
                    "遵义市": { longitude: 106.9 },
                    "安顺市": { longitude: 105.9 },
                    "毕节市": { longitude: 105.2 },
                    "铜仁市": { longitude: 109.1 },
                    "黔东南苗族侗族自治州": { longitude: 107.9 },
                    "黔南布依族苗族自治州": { longitude: 107.5 },
                    "黔西南布依族苗族自治州": { longitude: 104.9 }
                },
                "云南省": {
                    "昆明市": { longitude: 102.7 },
                    "曲靖市": { longitude: 103.8 },
                    "玉溪市": { longitude: 102.5 },
                    "保山市": { longitude: 99.1 },
                    "昭通市": { longitude: 103.7 },
                    "丽江市": { longitude: 100.2 },
                    "普洱市": { longitude: 101.0 },
                    "临沧市": { longitude: 99.9 },
                    "楚雄彝族自治州": { longitude: 101.5 },
                    "红河哈尼族彝族自治州": { longitude: 103.4 },
                    "文山壮族苗族自治州": { longitude: 104.2 },
                    "西双版纳傣族自治州": { longitude: 100.8 },
                    "大理白族自治州": { longitude: 100.2 },
                    "德宏傣族景颇族自治州": { longitude: 98.6 },
                    "怒江傈僳族自治州": { longitude: 98.8 },
                    "迪庆藏族自治州": { longitude: 99.7 }
                },
                "西藏自治区": {
                    "拉萨市": { longitude: 91.1 },
                    "日喀则市": { longitude: 88.8 },
                    "昌都市": { longitude: 97.1 },
                    "林芝市": { longitude: 94.3 },
                    "山南市": { longitude: 91.7 },
                    "那曲市": { longitude: 92.0 },
                    "阿里地区": { longitude: 80.1 }
                },
                "陕西省": {
                    "西安市": { longitude: 108.9 },
                    "铜川市": { longitude: 109.1 },
                    "宝鸡市": { longitude: 107.1 },
                    "咸阳市": { longitude: 108.7 },
                    "渭南市": { longitude: 109.5 },
                    "延安市": { longitude: 109.4 },
                    "汉中市": { longitude: 107.0 },
                    "榆林市": { longitude: 109.7 },
                    "安康市": { longitude: 109.0 },
                    "商洛市": { longitude: 110.0 }
                },
                "甘肃省": {
                    "兰州市": { longitude: 103.7 },
                    "嘉峪关市": { longitude: 98.2 },
                    "金昌市": { longitude: 102.2 },
                    "白银市": { longitude: 104.1 },
                    "天水市": { longitude: 105.7 },
                    "武威市": { longitude: 102.6 },
                    "张掖市": { longitude: 100.4 },
                    "平凉市": { longitude: 106.6 },
                    "酒泉市": { longitude: 98.5 },
                    "庆阳市": { longitude: 107.6 },
                    "定西市": { longitude: 104.6 },
                    "陇南市": { longitude: 104.9 },
                    "临夏回族自治州": { longitude: 103.2 },
                    "甘南藏族自治州": { longitude: 102.9 }
                },
                "青海省": {
                    "西宁市": { longitude: 101.7 },
                    "海东市": { longitude: 102.1 },
                    "海北藏族自治州": { longitude: 100.9 },
                    "黄南藏族自治州": { longitude: 102.0 },
                    "海南藏族自治州": { longitude: 100.6 },
                    "果洛藏族自治州": { longitude: 100.2 },
                    "玉树藏族自治州": { longitude: 97.0 },
                    "海西蒙古族藏族自治州": { longitude: 97.0 }
                },
                "宁夏回族自治区": {
                    "银川市": { longitude: 106.2 },
                    "石嘴山市": { longitude: 106.3 },
                    "吴忠市": { longitude: 106.1 },
                    "固原市": { longitude: 106.2 },
                    "中卫市": { longitude: 105.1 }
                },
                "新疆维吾尔自治区": {
                    "乌鲁木齐市": { longitude: 87.6 },
                    "克拉玛依市": { longitude: 84.7 },
                    "吐鲁番市": { longitude: 89.2 },
                    "哈密市": { longitude: 93.5 },
                    "昌吉回族自治州": { longitude: 87.3 },
                    "博尔塔拉蒙古自治州": { longitude: 82.0 },
                    "巴音郭楞蒙古自治州": { longitude: 86.1 },
                    "阿克苏地区": { longitude: 80.3 },
                    "克孜勒苏柯尔克孜自治州": { longitude: 76.2 },
                    "喀什地区": { longitude: 75.9 },
                    "和田地区": { longitude: 79.9 },
                    "伊犁哈萨克自治州": { longitude: 81.3 },
                    "塔城地区": { longitude: 82.9 },
                    "阿勒泰地区": { longitude: 88.1 },
                    "石河子市": { longitude: 86.0 },
                    "阿拉尔市": { longitude: 81.2 },
                    "图木舒克市": { longitude: 79.0 },
                    "五家渠市": { longitude: 87.2 }
                },
                "香港特别行政区": { "香港": { longitude: 114.1 } },
                "澳门特别行政区": { "澳门": { longitude: 113.5 } },

            };

            function populateProvinces() {
                for (const province in locationData) {
                    const option = document.createElement('option');
                    option.value = province;
                    option.textContent = province;
                    provinceSelect.appendChild(option);
                }
            }

            function populateCities(province) {
                citySelect.innerHTML = '<option value="">-- 請選擇 --</option>';
                if (locationData[province]) {
                    for (const city in locationData[province]) {
                        const option = document.createElement('option');
                        option.value = city;
                        option.textContent = city;
                        citySelect.appendChild(option);
                    }
                }
            }

            // 計算儒略日
            function calculateJulianDate(year, month, day, hour, minute, second) {
                if (month <= 2) {
                    year -= 1;
                    month += 12;
                }
                let a = Math.floor(year / 100);
                let b = 2 - a + Math.floor(a / 4);
                let jd = Math.floor(365.25 * (year + 4716)) + Math.floor(30.6001 * (month + 1)) +
                    day + b - 1524.5 + hour / 24 + minute / 1440 + second / 86400;
                return jd;
            }

            // 計算均時差（單位：分鐘）
            function calculateEquationOfTime(jd) {
                // 將儒略日轉換為世紀數
                let T = (jd - 2451545.0) / 36525;

                // 計算太陽平均黃經（度）
                let L0 = 280.46646 + 36000.76983 * T + 0.0003032 * T * T;
                L0 = L0 % 360;
                if (L0 < 0) L0 += 360;

                // 計算近日點平均角距（度）
                let M = 357.52911 + 35999.05029 * T - 0.0001537 * T * T;
                M = M % 360;
                if (M < 0) M += 360;
                let M_rad = M * Math.PI / 180;

                // 計算黃道方程（度）
                let e = 0.016708634 - 0.000042037 * T - 0.0000001267 * T * T;
                let C = (1.914602 - 0.004817 * T - 0.000014 * T * T) * Math.sin(M_rad)
                    + (0.019993 - 0.000101 * T) * Math.sin(2 * M_rad)
                    + 0.000289 * Math.sin(3 * M_rad);

                // 計算真黃經（度）
                let L = L0 + C;
                let L_rad = L * Math.PI / 180;

                // 計算黃道傾角（度）
                let eps = 23.43929111 - 0.013004167 * T - 0.000000164 * T * T + 0.000000503 * T * T * T;
                let eps_rad = eps * Math.PI / 180;

                // 計算赤經（弧度）
                let RA = Math.atan2(Math.cos(eps_rad) * Math.sin(L_rad), Math.cos(L_rad));
                if (RA < 0) RA += 2 * Math.PI;

                // 計算均時差（分鐘）
                let eot = (L0 / 15 - RA * 12 / Math.PI) * 60;

                // 修正極端值，確保結果在合理範圍內
                if (eot > 20) eot -= 24 * 60;
                if (eot < -20) eot += 24 * 60;

                return eot;
            }

            // 計算真太陽時
            function calculateTrueSolarTime(dateTime, longitude) {
                // 北京時區（UTC+8）
                const TIMEZONE = 8;

                let year = dateTime.getFullYear();
                let month = dateTime.getMonth() + 1;
                let day = dateTime.getDate();
                let hour = dateTime.getHours();
                let minute = dateTime.getMinutes();
                let second = dateTime.getSeconds();

                // 計算儒略日
                let jd = calculateJulianDate(year, month, day, hour, minute, second);

                // 計算均時差（分鐘）
                let eot = calculateEquationOfTime(jd);

                // 計算經度修正（分鐘）
                let longitudeCorrection = (longitude - TIMEZONE * 15) * 4;

                // 計算真太陽時（分鐘）
                let totalMinutes = hour * 60 + minute + second / 60 + eot + longitudeCorrection;

                // 轉換為時分秒
                let trueSolarHours = Math.floor(totalMinutes / 60) % 24;
                let trueSolarMinutes = Math.floor(totalMinutes % 60);
                let trueSolarSeconds = Math.floor((totalMinutes * 60) % 60);

                // 處理日期變更
                let trueSolarDate = new Date(dateTime);
                if (trueSolarHours < 0) {
                    trueSolarHours += 24;
                    trueSolarDate.setDate(trueSolarDate.getDate() - 1);
                } else if (trueSolarHours >= 24) {
                    trueSolarHours -= 24;
                    trueSolarDate.setDate(trueSolarDate.getDate() + 1);
                }

                // 格式化日期和時間
                const trueSolarYear = trueSolarDate.getFullYear();
                const trueSolarMonth = (trueSolarDate.getMonth() + 1).toString().padStart(2, '0');
                const trueSolarDay = trueSolarDate.getDate().toString().padStart(2, '0');

                return {
                    year: trueSolarYear,
                    month: trueSolarMonth,
                    day: trueSolarDay,
                    hours: trueSolarHours,
                    minutes: trueSolarMinutes,
                    timeString: `${trueSolarYear}/${trueSolarMonth}/${trueSolarDay} ${String(trueSolarHours).padStart(2, '0')}:${String(trueSolarMinutes).padStart(2, '0')}:${String(trueSolarSeconds).padStart(2, '0')}`
                }
            }

            function updateTrueSolarTime() {
                const dateTime = new Date(datetimeInput.value);

                const birthProvince = provinceSelect.value;
                const birthCity = citySelect.value;
                const longitude = locationData[birthProvince][birthCity].longitude

                const trueSolarTime = calculateTrueSolarTime(dateTime, longitude);
                document.getElementById('solar-time-result').textContent = trueSolarTime.timeString;
                document.getElementById('true-solar-time').style.display = 'block';

                return trueSolarTime;
            }

            function initializeSelectors() {
                const now = new Date('2000-01-01T13:44:00');
                // 格式化當前時間為datetime-local接受的格式 (YYYY-MM-DDThh:mm:ss)
                const year = now.getFullYear();
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const seconds = now.getSeconds().toString().padStart(2, '0');
                datetimeInput.value = `${year}-${month}-${day}T${hours}:${minutes}:${seconds}`;
            }

            function validateForm() {
                errorMessage.style.display = 'none';
                errorMessage.textContent = '';
                let isValid = true;

                if (!Array.from(genderRadios).some(radio => radio.checked)) {
                    errorMessage.textContent += "請選擇性別。";
                    isValid = false;
                }

                if (!isValid) {
                    errorMessage.style.display = 'block';
                }
                return isValid;
            }

            const stems = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];
            const branches = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"];
            const zodiac = ['鼠', '牛', '虎', '兔', '龍', '蛇', '馬', '羊', '猴', '雞', '狗', '豬'];

            let elements = {
                '金': 0,
                '木': 0,
                '水': 0,
                '火': 0,
                '土': 0
            };


            function calculateDayun(year, month, day, hour, gender, chineseDate) {
                console.log('calculateDayun', chineseDate);
                const solarTerms = [
                    [3, 5],
                    [4, 4],
                    [5, 5],
                    [6, 5],
                    [7, 7],
                    [8, 7],
                    [9, 7],
                    [10, 8],
                    [11, 7],
                    [12, 7],
                    [1, 5],
                    [2, 4]
                ];
                let direction = ((gender === '男' && ["甲", "丙", "戊", "庚", "壬"].includes(chineseDate[0].substring(0, 1))) ||
                    (gender === '女' && ["乙", "丁", "己", "辛", "癸"].includes(chineseDate[0].substring(0, 1)))) ? 1 : -1;

                let nextTermMonth = month % 12;
                let nextTermYear = year;
                if (direction === 1 && nextTermMonth === 11) nextTermYear++;
                if (direction === -1 && nextTermMonth === 0) nextTermYear--;
                let nextTermDay = solarTerms[nextTermMonth][0];
                let nextTermHour = solarTerms[nextTermMonth][1];

                let birthDate = new Date(year, month - 1, day, hour, 0, 0);
                let termDate = new Date(nextTermYear, nextTermMonth, nextTermDay, nextTermHour, 0, 0);

                let diff = termDate.getTime() - birthDate.getTime();
                if (direction === -1) diff = birthDate.getTime() - termDate.getTime();

                let days = Math.floor(diff / (1000 * 60 * 60 * 24));
                let dayunStartYears = Math.floor(days / 3);
                let dayunStartYear = year + direction * dayunStartYears;
                let dayunStartMonth = month;

                const dayun = [];
                let monthPillar = chineseDate[1];
                let monthStemIndex = stems.indexOf(monthPillar[0]);
                let monthBranchIndex = branches.indexOf(monthPillar[1]);

                for (let i = 0; i < 10; i++) {
                    monthStemIndex = (monthStemIndex + direction + 10) % 10;
                    monthBranchIndex = (monthBranchIndex + direction + 12) % 12;
                    dayun.push(stems[monthStemIndex] + branches[monthBranchIndex]);
                }
                return {
                    startYear: dayunStartYear,
                    dayun
                };
            }


            function generateBaziPrompt(year, month, day, hours, minutes, gender) {

                const lun = lunisolar(`${year}/${month}/${day} ${hours}:${minutes}`)
                const char8ex = lunisolar(`${year}/${month}/${day} ${hours}:${minutes}`).char8ex(gender ? 1 : 0)
                const bigLuck = calculateDayun(year, month, day, hours, gender, `${char8ex.char8}`);

                const astrolabe = iztro.astro.bySolar(`${year}/${month}/${day}`, lun.lunar.hour, gender ? '男' : "女", true, 'zh-TW');

                const wuxing = char8ex.char8.year.stem.e5.name + char8ex.char8.year.branch.e5.name + char8ex.char8.month.stem.e5.name + char8ex.char8.month.branch.e5.name + char8ex.char8.day.stem.e5.name + char8ex.char8.day.branch.e5.name + char8ex.char8.hour.stem.e5.name + char8ex.char8.hour.branch.e5.name;

                elements = {
                    '金': 0,
                    '木': 0,
                    '水': 0,
                    '火': 0,
                    '土': 0
                };

                for (let char of wuxing) {
                    if (char in elements) {
                        elements[char]++;
                    }
                }

                // let ziwei = ''
                // for (let palace of astrolabe.palaces) {
                //     ziwei += `宮位：${palace.heavenlyStem + palace.earthlyBranch} ${palace.name}，主星：`
                //     if (palace.majorStars.length === 0) {
                //         ziwei += '無 ';
                //     } else {
                //         for (let star of palace.majorStars) {
                //             ziwei += `${star.name}(${star.brightness}) `;
                //         }
                //     }


                //     ziwei += `，副星：`
                //     if (palace.minorStars.length === 0) {
                //         ziwei += '無 ';
                //     } else {
                //         for (let star of palace.minorStars) {
                //             ziwei += `${star.name}(${star.brightness}) `;
                //         }
                //     }
                //     ziwei += '\n';

                // }
                // ziwei = ziwei.replaceAll('()', '')

                let prompt = "";
                prompt += `你是一位對中國傳統八字命理學有著深刻理解和豐富經驗的專家。你精通《滴天髓》、《子平真詮》、《窮通寶鑒》等經典著作，擅長運用五行生克、十神意象、格局喜忌、紫微斗數等理論，對人生命運進行分析和解讀。\n\n`;
                prompt += `現在你將面對一個八字命例，請你運用你的專業知識和經驗，對該命盤進行全面、深入的分析，並給出有價值的建議。請你務必逐步思考、推理，並清晰地展示你的思考過程。\n\n`;

                prompt += `求測者的基本資訊如下：\n`;
                prompt += `性别：${gender}\n`;
                prompt += `出生年份：${year}年\n`;
                prompt += `生肖：${zodiac[char8ex.char8.year.branch.value]}\n`;
                prompt += `星座：${astrolabe.sign}\n\n`;

                prompt += `其八字命盤如下：\n`;
                prompt += `年柱：${char8ex.char8.year.toString()}(${char8ex.year.stemTenGod.name}) 柱纳音：${char8ex.year.takeSound} 五行：${char8ex.char8.year.stem.e5.name + char8ex.char8.year.branch.e5.name}\n`;
                prompt += `月柱：${char8ex.char8.month.toString()}(${char8ex.month.stemTenGod.name}) 柱纳音：${char8ex.month.takeSound} 五行：${char8ex.char8.month.stem.e5.name + char8ex.char8.month.branch.e5.name}\n`;
                prompt += `日柱：${char8ex.char8.day.toString()}(${char8ex.day.stemTenGod.name}) 柱纳音：${char8ex.day.takeSound} 五行：${char8ex.char8.day.stem.e5.name + char8ex.char8.day.branch.e5.name}\n`;
                prompt += `時柱：${char8ex.char8.hour.toString()}(${char8ex.hour.stemTenGod.name}) 柱纳音：${char8ex.hour.takeSound} 五行：${char8ex.char8.hour.stem.e5.name + char8ex.char8.hour.branch.e5.name}\n`;
                prompt += `五行：金(${elements['金']})、木(${elements['木']})、水(${elements['水']})、火(${elements['火']})、土(${elements['土']})\n\n`;

                prompt += `大運信息：從${bigLuck.startYear}年起運，運程順序為：${bigLuck.dayun.join('、')}\n\n`;

                prompt += `請你從以下幾個方面入手，展開你的分析：\n\n`;

                prompt += `1.整體審視命局：首先，請你對整個八字命例進行審視，從五行、陰陽、十神、格局等多個角度入手，對命局的整體特點進行概括性的描述。例如，五行是否均衡？陰陽是否協調？是否存在某種特殊的格局？日元得令、得地、得助嗎？\n\n`;

                prompt += `2.分析日元強弱：日元代表命主自身，其強弱直接關系到命主的運勢。請你結合月令、地支、天幹等因素，綜合判斷日元的強弱，並說明判斷的依據。如果日元偏強，喜什麽？忌什麽？如果日元偏弱，又該如何取用神？\n\n`;

                prompt += `3.剖析性格特征：性格決定命運。請你結合八字命例，分析命主的性格特點、優缺點，以及可能的發展方向。例如，是積極進取還是保守穩重？是善於交際還是喜歡獨處？是理性思維還是感性思維？這些性格特點對命主的人生有何影響？\n\n`;

                prompt += `4.推斷事業發展：事業是人生價值的重要體現。請你結合八字命例，分析命主的事業運勢、適合的職業、發展方向等。例如，適合從事穩定的工作還是具有挑戰性的工作？適合自己創業還是在企業中發展？在事業發展過程中需要注意哪些問題？\n\n`;

                prompt += `5.預測財富運勢：財富是人生幸福的重要保障。請你結合八字命例，分析命主的財富狀況、財運走勢、理財建議等。例如，是正財運旺盛還是偏財運旺盛？適合從事哪些行業的投資？在理財方面需要注意哪些問題？\n\n`;

                prompt += `6.研判婚姻情感：婚姻是人生重要的組成部分。請你結合八字命例，分析命主的婚姻運勢、情感狀況、婚戀建議等。例如，是早婚好還是晚婚好？適合找什麽樣的伴侶？在婚姻中需要注意哪些問題？\n\n`;

                prompt += `7.關注健康狀況：健康是幸福人生的基石。請你結合八字命例，分析命主的健康狀況、可能存在的健康隱患、養生建議等。例如，五行失衡可能導致哪些疾病？需要注意哪些方面的保健？\n\n`;

                prompt += `8.洞察六親關系：六親是與命主關系最為密切的人。請你結合八字命例，分析命主與父母、配偶、子女等六親的關系，以及六親對命主的影響。例如，與父母的關系如何？配偶對自己有幫助嗎？子女是否孝順？\n\n`;

                prompt += `9.把握大運流年：大運和流年是影響命主運勢的重要因素。請你結合大運和流年，分析命主在不同人生階段的運勢變化，為命主提供人生規劃建議。例如，哪些年份是機遇期？哪些年份是挑戰期？應該如何把握機遇、應對挑戰？\n\n`;

                prompt += `在分析過程中，請你充分發揮你的聰明才智，運用你所掌握的命理學知識，結合實際情況，對命盤進行深入的剖析和解讀，並給出有價值的建議。\n\n`;
                prompt += `請記住，你的目標是幫助求測者更好地了解自己，把握命運，創造幸福的人生。\n\n`;
                prompt += `請開始你的分析吧！`;

                return prompt;
            }

            window.copyPrompt = function () {
                const promptText = outputDiv.textContent.replace('複製', '').trim();
                navigator.clipboard.writeText(promptText)
                    .then(() => {
                        alert('Prompt 複製完成！');
                    })
                    .catch(err => {
                        console.error('複製失敗:', err);
                        alert('複製失敗，請手動複製。');
                    });
            };


            window.copyResult = function () {
                const resultText = svgOutput.textContent.replace('複製', '').trim();
                navigator.clipboard.writeText(resultText)
                    .then(() => {
                        alert('複製完成！');
                    })
                    .catch(err => {
                        console.error('複製失敗:', err);
                        alert('複製失敗，請手動複製。');
                    });
            };

            generateBtn.addEventListener('click', function () {
                if (validateForm()) {
                    resultLayout.style.display = 'block';

                    const gender = document.querySelector('input[name="gender"]:checked').value;

                    const { year, month, day, hours, minutes } = updateTrueSolarTime();

                    const prompt = generateBaziPrompt(year, month, day, hours, minutes, gender);

                    outputDiv.textContent = prompt;
                    outputDiv.innerHTML = `<button class="copy-btn" onclick="copyPrompt()">複製</button>` + `<br>` + prompt;

                    fetchResult(prompt);
                }
            });

            const apiUrl = "https://europe-west3-durable-pulsar-384402.cloudfunctions.net/ai"

            const loadingOverlay = document.querySelector('.loading-overlay');

            async function fetchResult(prompt) {
                loadingOverlay.style.display = 'flex';

                const apiBody = {
                    "userId": '0_cyber8',
                    "text": prompt,
                    "type": "text",
                }
                try {
                    const response = await fetch(`${apiUrl}?type=8z`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(apiBody)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    svgOutput.innerHTML = `<button class="copy-btn" onclick="copyResult()">複製</button></br>` + marked.parse(data.msg.trim().replace('鬥數', '斗數'));

                } catch (error) {
                    console.error('API請求失敗:', error);
                } finally {
                    loadingOverlay.style.display = 'none';
                }
            }

            initializeSelectors();
            populateProvinces();
            populateCities('台灣');
            provinceSelect.addEventListener('change', function () {
                const selectedProvince = this.value;
                populateCities(selectedProvince);
            });
        });

        function switchTab(tabName) {

            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            document.querySelector(`.tab-button[onclick*="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

    </script>

    <script>
        window['addAds'] = function () {
            const cardList = document.getElementsByClassName('gads');
            for (let i = 0; i < cardList.length; i++) {
                (adsbygoogle = window.adsbygoogle || []).push({});
            }
        }
    </script>
</body>

</html>