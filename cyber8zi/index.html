<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta charset="utf-8">
    <meta content="initial-scale=1, minimum-scale=1, width=device-width" name="viewport">
    <meta name="author" content="Jakevin 羅旭辰" />
    <meta name="publisher" content="Jakevin 羅旭辰" />
    <meta name="company" content="北科大工工所" />

    <meta name="rating" content="general" />
    <meta name="copyright" content="&copy; Jakevin Lo" />
    <meta name="robots" content="all" />
    <meta name="spiders" content="all" />
    <meta name="webcrawlers" content="all" />
    <meta name="theme-color" content="#0085d5">
    <meta name="abstract" content="賽博八字算命| Cyber Fortune Telling" />
    <meta name="subject" content="賽博八字算命| Cyber Fortune Telling" />
    <meta name="description" content="賽博八字算命| Cyber Fortune Telling" />
    <meta name="keywords" content="北科大, TTI, AI, FLUX, GPT" />
    <meta property="og:site_name" content="Jakevin" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="賽博八字算命| Cyber Fortune Telling" />
    <meta property="og:url" content="https://jakevin.github.io/" />
    <meta property="og:description" content="賽博八字算命| Cyber Fortune Telling" />
    <meta property="og:image"
        content="https://api.together.ai/imgproxy/pXOo77HixdTIUEFb39BSE0_szy_9bn6i9y-uP5kFH5g/format:jpg/aHR0cHM6Ly90b2dldGhlci1haS1iZmwtaW1hZ2VzLXByb2QuczMudXMtd2VzdC0yLmFtYXpvbmF3cy5jb20vaW1hZ2VzLzk0OGRjMzBkYmM2MDBmNzRhZWZmMGU0ZmUwMDM1ZjhjNTFjNGRlYTNhNWY5MGFkNzM0NzBlNzQxZDIyOWYwNmQ_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ29udGVudC1TaGEyNTY9VU5TSUdORUQtUEFZTE9BRCZYLUFtei1DcmVkZW50aWFsPUFTSUFZV1pXNEhWQ0FUV1Q3SlJIJTJGMjAyNDEwMDglMkZ1cy13ZXN0LTIlMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQxMDA4VDE2MDAxOVomWC1BbXotRXhwaXJlcz0zNjAwJlgtQW16LVNlY3VyaXR5LVRva2VuPUlRb0piM0pwWjJsdVgyVmpFUEQlMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkZ3RWFDWFZ6TFhkbGMzUXRNaUpHTUVRQ0lEd2dydUNUOVdZOFpSSUFHV2dSRXR4TFZrJTJCdWg4R3ZaUyUyQjVZczNDSUFZdUFpQnUxNWkzeWxmNzFFJTJGb0x6WFAlMkJRWkpaa0RldVhZQWI2QlJCJTJCMSUyRmtSUHczeXFRQlFoSkVBQWFERFU1T0RjeU5qRTJNemM0TUNJTXhBUiUyQlRhWUtPejlyMWxEYkt1MEUwJTJCbUM1UzNtQlY0Q0daeWowJTJGR0hUZ1J1cyUyRkVJYVk0UXh4c2V6dGwyNHBqeVlMZDhJWHZueGdVVVJuYnNFZ0lFaldac3ViZ1lONyUyQnl3TGV0MUJkcCUyQiUyQnNnTmZ3Y1pSOTkzN0NickRTbGVpODB0cDdyb3cwT2hTd2x1QTNIM3BpakFzRElkSzNqaWR2Z2hNWkFYUkolMkYyUndSUHZPaHlseEU2b2toS2IyMGRKekhEUzNRRlRVRG5jZGpNJTJGaWoyZmV1MFN6VDhBd1RZQWNBaFJGaEo3ViUyQnFvMElyZ2ZRRVV6RmNSSEhmVTlzb3hkUjZYQUUxdSUyQndBb3htOUVJNllqT2NNckVPNzFjSHRjd0IwV3FnJTJGNThlbnoyOEZMdlUlMkZYY3RSS2F6dm9zUHNMcGdHamJLeXc3b3hTJTJGSFAlMkZFb2haVTBzZUhGZVBRdXlKcTg5dHNHQnU5RmJpNUVyekg4amxHNGtMMmQ3RTJwNFFETm11RHNiR2tmTGRLY1EyZSUyQkUlMkZrR1M3MWNJVjNkU0FNRERmMmpPcUdUcUtVa3dCZVElMkJuNndnaWZ3cGEybnpvak5hcGFRbFhQNThUbkpBQSUyQk83U3QzU0dSYkdQQm1tZFRIJTJGenFRZ2tjTTBDRVNqMzNSTEZLTjJWOU1mTXFxakkzJTJCRGJtYm1SbVBSc0NoY2ZPNnNjaFJiNlJOdiUyQmZIczU2M0ZDZkgzNjNJeVNtNEx3Yk54TlFncENVMGdDeEI0dEFOMmo4ck9xemJSVmMyJTJCVVhqYW10VCUyQnF0SmtBOWxXaTNaUTZRazlXTU9hanJqdnQxSmhnY2VrQlN0TXklMkZUaGd5QjhaWUEyclBpczdKRk41ZVY1JTJCOUo4TmdGNGh3Z044U05jSTZtJTJGQXNhb1dvSUNPV1NSb1NsRHViQ0Z5UVVvSFlHMUwlMkJGNEpxczlKS1RrOE9JRDUlMkJlNDFSeDQ2TW9HY1k5ZHBwVmVUNVhtdkdlS2xoNGhKNG5LS0xzN3R0bGJFZFVnYjMlMkJMVGkzdmNEdXNRSmE5ZUxDJTJCczQlMkJNWXc2Tzg3NDZ6NktoSTRnb1hReUQxMHZEejFKYUFsdXdjWDdQJTJGdVBUSEdWd0pnV3hrQ0hhN2w5TUpPdWxiZ0dPcHdCQVhUVGZNRHVITDVtNU5nRVdtTmd4JTJCUmNic1hOcUMzUDFKdWZnOGVJT1lsU1lSVklVZFJLODlzVHJHa3dZU0JzNUJNSnlkalJTQnBJeUxjdnppVk1PWWFGZExiZVAlMkZJZmJZTXRFeno0STh0WnBycUpFeWJScDZ2R21vUTNIWSUyRlBoWlolMkZWR2lMQkY3NGYxV1hUYnBobnp1VjVRTXRkcTMzclNleWhwVHNlYjJwRHhKcSUyRnYwNDQ5T0N2dHo5NTZiMWlCejh5OGtLbDB4M3N3cDcmWC1BbXotU2lnbmF0dXJlPWViZDU4NDU1ODg0OTM0M2ZiNDdjMmMwMDg5MzU0ZjIxYjViYmVmOGY5NDhjOTI3ZjcyMDJjMmE4ODkzMzgxOGUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JngtaWQ9R2V0T2JqZWN0" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@Jakevin16" />
    <meta name="twitter:title" content="賽博八字算命| Cyber Fortune Telling" />
    <meta name="twitter:url" content="https://jakevin.github.io/" />
    <meta name="twitter:description" content="賽博八字算命| Cyber Fortune Telling" />
    <meta name="twitter:image:src"
        content="https://api.together.ai/imgproxy/pXOo77HixdTIUEFb39BSE0_szy_9bn6i9y-uP5kFH5g/format:jpg/aHR0cHM6Ly90b2dldGhlci1haS1iZmwtaW1hZ2VzLXByb2QuczMudXMtd2VzdC0yLmFtYXpvbmF3cy5jb20vaW1hZ2VzLzk0OGRjMzBkYmM2MDBmNzRhZWZmMGU0ZmUwMDM1ZjhjNTFjNGRlYTNhNWY5MGFkNzM0NzBlNzQxZDIyOWYwNmQ_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ29udGVudC1TaGEyNTY9VU5TSUdORUQtUEFZTE9BRCZYLUFtei1DcmVkZW50aWFsPUFTSUFZV1pXNEhWQ0FUV1Q3SlJIJTJGMjAyNDEwMDglMkZ1cy13ZXN0LTIlMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQxMDA4VDE2MDAxOVomWC1BbXotRXhwaXJlcz0zNjAwJlgtQW16LVNlY3VyaXR5LVRva2VuPUlRb0piM0pwWjJsdVgyVmpFUEQlMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkZ3RWFDWFZ6TFhkbGMzUXRNaUpHTUVRQ0lEd2dydUNUOVdZOFpSSUFHV2dSRXR4TFZrJTJCdWg4R3ZaUyUyQjVZczNDSUFZdUFpQnUxNWkzeWxmNzFFJTJGb0x6WFAlMkJRWkpaa0RldVhZQWI2QlJCJTJCMSUyRmtSUHczeXFRQlFoSkVBQWFERFU1T0RjeU5qRTJNemM0TUNJTXhBUiUyQlRhWUtPejlyMWxEYkt1MEUwJTJCbUM1UzNtQlY0Q0daeWowJTJGR0hUZ1J1cyUyRkVJYVk0UXh4c2V6dGwyNHBqeVlMZDhJWHZueGdVVVJuYnNFZ0lFaldac3ViZ1lONyUyQnl3TGV0MUJkcCUyQiUyQnNnTmZ3Y1pSOTkzN0NickRTbGVpODB0cDdyb3cwT2hTd2x1QTNIM3BpakFzRElkSzNqaWR2Z2hNWkFYUkolMkYyUndSUHZPaHlseEU2b2toS2IyMGRKekhEUzNRRlRVRG5jZGpNJTJGaWoyZmV1MFN6VDhBd1RZQWNBaFJGaEo3ViUyQnFvMElyZ2ZRRVV6RmNSSEhmVTlzb3hkUjZYQUUxdSUyQndBb3htOUVJNllqT2NNckVPNzFjSHRjd0IwV3FnJTJGNThlbnoyOEZMdlUlMkZYY3RSS2F6dm9zUHNMcGdHamJLeXc3b3hTJTJGSFAlMkZFb2haVTBzZUhGZVBRdXlKcTg5dHNHQnU5RmJpNUVyekg4amxHNGtMMmQ3RTJwNFFETm11RHNiR2tmTGRLY1EyZSUyQkUlMkZrR1M3MWNJVjNkU0FNRERmMmpPcUdUcUtVa3dCZVElMkJuNndnaWZ3cGEybnpvak5hcGFRbFhQNThUbkpBQSUyQk83U3QzU0dSYkdQQm1tZFRIJTJGenFRZ2tjTTBDRVNqMzNSTEZLTjJWOU1mTXFxakkzJTJCRGJtYm1SbVBSc0NoY2ZPNnNjaFJiNlJOdiUyQmZIczU2M0ZDZkgzNjNJeVNtNEx3Yk54TlFncENVMGdDeEI0dEFOMmo4ck9xemJSVmMyJTJCVVhqYW10VCUyQnF0SmtBOWxXaTNaUTZRazlXTU9hanJqdnQxSmhnY2VrQlN0TXklMkZUaGd5QjhaWUEyclBpczdKRk41ZVY1JTJCOUo4TmdGNGh3Z044U05jSTZtJTJGQXNhb1dvSUNPV1NSb1NsRHViQ0Z5UVVvSFlHMUwlMkJGNEpxczlKS1RrOE9JRDUlMkJlNDFSeDQ2TW9HY1k5ZHBwVmVUNVhtdkdlS2xoNGhKNG5LS0xzN3R0bGJFZFVnYjMlMkJMVGkzdmNEdXNRSmE5ZUxDJTJCczQlMkJNWXc2Tzg3NDZ6NktoSTRnb1hReUQxMHZEejFKYUFsdXdjWDdQJTJGdVBUSEdWd0pnV3hrQ0hhN2w5TUpPdWxiZ0dPcHdCQVhUVGZNRHVITDVtNU5nRVdtTmd4JTJCUmNic1hOcUMzUDFKdWZnOGVJT1lsU1lSVklVZFJLODlzVHJHa3dZU0JzNUJNSnlkalJTQnBJeUxjdnppVk1PWWFGZExiZVAlMkZJZmJZTXRFeno0STh0WnBycUpFeWJScDZ2R21vUTNIWSUyRlBoWlolMkZWR2lMQkY3NGYxV1hUYnBobnp1VjVRTXRkcTMzclNleWhwVHNlYjJwRHhKcSUyRnYwNDQ5T0N2dHo5NTZiMWlCejh5OGtLbDB4M3N3cDcmWC1BbXotU2lnbmF0dXJlPWViZDU4NDU1ODg0OTM0M2ZiNDdjMmMwMDg5MzU0ZjIxYjViYmVmOGY5NDhjOTI3ZjcyMDJjMmE4ODkzMzgxOGUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JngtaWQ9R2V0T2JqZWN0" />
    <title>賽博八字算命</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lunisolar-full@2.4.0-4/dist/lunisolar.min.js"></script>

    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            padding: 0;
            background-color: #f4f4f4;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        input[type="number"],
        input[type="time"],
        select,
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .date-group {
            display: flex;
            gap: 10px;
        }

        .date-group input {
            width: 33%;
        }

        .radio-group {
            display: flex;
            gap: 20px;
        }

        .radio-group label {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        input[type="radio"] {
            margin: 0;
        }

        #generate-btn {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
        }

        #generate-btn:hover {
            background-color: #0056b3;
        }

        #error-message {
            color: red;
            margin-top: 10px;
            display: none;
        }

        pre {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            position: relative;
        }

        .form-section {
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }

        .form-section:last-child {
            border-bottom: none;
        }

        .copy-btn {
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .copy-btn:hover {
            background-color: #0056b3;
        }

        #svgOutput {
            border: 1px solid #ddd;
            padding: 15px;
            line-height: 1.6;
        }

        #svgOutput code {
            background-color: #f5f5f5;
            padding: 2px 4px;
            border-radius: 4px;
            font-family: monospace;
        }

        #svgOutput pre {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }

        #svgOutput pre code {
            background-color: transparent;
            padding: 0;
        }

        #svgOutput blockquote {
            border-left: 4px solid #ddd;
            padding-left: 15px;
            margin-left: 0;
            color: #666;
        }

        #svgOutput h1,
        #svgOutput h2,
        #svgOutput h3,
        #svgOutput h4 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
        }

        #svgOutput ul,
        #svgOutput ol {
            padding-left: 20px;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .progress-bar {
            width: 80%;
            max-width: 500px;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar-inner {
            width: 100%;
            height: 100%;
            background-color: #4CAF50;
            animation: progress 2s infinite linear;
            transform-origin: left;
        }

        @keyframes progress {
            0% {
                transform: scaleX(0);
            }

            50% {
                transform: scaleX(1);
            }

            100% {
                transform: scaleX(0);
            }
        }
    </style>
</head>

<body>
    <div class="loading-overlay">
        <div class="progress-bar">
            <div class="progress-bar-inner"></div>
        </div>
    </div>
    <div class="container">
        <h1>賽博八字綜合分析Prompt生成器</h1>

        <div class="form-section">
            <label>出生日期 (西元):</label>
            <div class="date-group">
                <input type="datetime-local" id="datetime" step="1">
            </div>
        </div>

        <div class="form-section">
            <label>性別:</label>
            <div class="radio-group">
                <label><input type="radio" name="gender" value="男" required> 男</label>
                <label><input type="radio" name="gender" value="女" required> 女</label>
            </div>
            <p>
                重要宣告：</br>
                八字命理是一種複雜的學問僅供參考，不能作為決策的唯一依據。
            </p>
        </div>

        <button id="generate-btn">請幫我算一算！</button>
        <div id="error-message"></div>
        <h2>結果:</h2>
        <div id="svgOutput">

        </div>
        <h2>Prompt:</h2>

        <pre id="output">
            <button class="copy-btn" onclick="copyPrompt()">複製</button>
        </pre>
        <div>
            <p>本工具使用 <a href="https://lunisolar.js.org/" target="_blank">lunisolar</a> 作為天干地支的轉換工具</p>
        </div>
    </div>

    <script>


        document.addEventListener('DOMContentLoaded', function () {
            const datetimeInput = document.getElementById('datetime');

            const genderRadios = document.getElementsByName('gender');
            const generateBtn = document.getElementById('generate-btn');
            const errorMessage = document.getElementById('error-message');
            const outputDiv = document.getElementById('output');
            const svgOutput = document.getElementById('svgOutput');

            function initializeSelectors() {
                const now = new Date('2000-01-01T13:00:00');
                // 格式化當前時間為datetime-local接受的格式 (YYYY-MM-DDThh:mm:ss)
                const year = now.getFullYear();
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const seconds = now.getSeconds().toString().padStart(2, '0');
                datetimeInput.value = `${year}-${month}-${day}T${hours}:${minutes}:${seconds}`;
            }

            function validateForm() {
                errorMessage.style.display = 'none';
                errorMessage.textContent = '';
                let isValid = true;

                if (!Array.from(genderRadios).some(radio => radio.checked)) {
                    errorMessage.textContent += "請選擇性別。";
                    isValid = false;
                }

                if (!isValid) {
                    errorMessage.style.display = 'block';
                }
                return isValid;
            }

            const stems = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];
            const branches = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"];
            const zodiac = ['鼠', '牛', '虎', '兔', '龍', '蛇', '馬', '羊', '猴', '雞', '狗', '豬'];

            let elements = {
                '金': 0,
                '木': 0,
                '水': 0,
                '火': 0,
                '土': 0
            };


            function calculateDayun(year, month, day, hour, gender, chineseDate) {
                console.log('calculateDayun', chineseDate);
                const solarTerms = [
                    [3, 5],
                    [4, 4],
                    [5, 5],
                    [6, 5],
                    [7, 7],
                    [8, 7],
                    [9, 7],
                    [10, 8],
                    [11, 7],
                    [12, 7],
                    [1, 5],
                    [2, 4]
                ];
                let direction = ((gender === '男' && ["甲", "丙", "戊", "庚", "壬"].includes(chineseDate[0].substring(0, 1))) ||
                    (gender === '女' && ["乙", "丁", "己", "辛", "癸"].includes(chineseDate[0].substring(0, 1)))) ? 1 : -1;

                let nextTermMonth = month % 12;
                let nextTermYear = year;
                if (direction === 1 && nextTermMonth === 11) nextTermYear++;
                if (direction === -1 && nextTermMonth === 0) nextTermYear--;
                let nextTermDay = solarTerms[nextTermMonth][0];
                let nextTermHour = solarTerms[nextTermMonth][1];

                let birthDate = new Date(year, month - 1, day, hour, 0, 0);
                let termDate = new Date(nextTermYear, nextTermMonth, nextTermDay, nextTermHour, 0, 0);

                let diff = termDate.getTime() - birthDate.getTime();
                if (direction === -1) diff = birthDate.getTime() - termDate.getTime();

                let days = Math.floor(diff / (1000 * 60 * 60 * 24));
                let dayunStartYears = Math.floor(days / 3);
                let dayunStartYear = year + direction * dayunStartYears;
                let dayunStartMonth = month;

                const dayun = [];
                let monthPillar = chineseDate[1];
                let monthStemIndex = stems.indexOf(monthPillar[0]);
                let monthBranchIndex = branches.indexOf(monthPillar[1]);

                for (let i = 0; i < 10; i++) {
                    monthStemIndex = (monthStemIndex + direction + 10) % 10;
                    monthBranchIndex = (monthBranchIndex + direction + 12) % 12;
                    dayun.push(stems[monthStemIndex] + branches[monthBranchIndex]);
                }
                return {
                    startYear: dayunStartYear,
                    dayun
                };
            }


            function generateBaziPrompt(year, month, day, hours, minutes, gender) {

                const lun = lunisolar(`${year}/${month}/${day} ${hours}:${minutes}`).char8ex(gender ? 1 : 0)
                const bigLuck = calculateDayun(year, month, day, hours, gender, `${lun.char8}`);

                const w = lun.char8.year.stem.e5.name + lun.char8.year.branch.e5.name + lun.char8.month.stem.e5.name + lun.char8.month.branch.e5.name + lun.char8.day.stem.e5.name + lun.char8.day.branch.e5.name + lun.char8.hour.stem.e5.name + lun.char8.hour.branch.e5.name;

                elements = {
                    '金': 0,
                    '木': 0,
                    '水': 0,
                    '火': 0,
                    '土': 0
                };

                for (let char of w) {
                    if (char in elements) {
                        elements[char]++;
                    }
                }

                let prompt = "";
                prompt += `你是一位對中國傳統八字命理學有著深刻理解和豐富經驗的專家。你精通《滴天髓》、《子平真詮》、《窮通寶鑒》等經典著作，擅長運用五行生克、十神意象、格局喜忌等理論，對人生命運進行分析和解讀。\n\n`;
                prompt += `現在你將面對一個八字命例，請你運用你的專業知識和經驗，對該命例進行全面、深入的分析，並給出有價值的建議。請你務必逐步思考、推理，並清晰地展示你的思考過程。\n\n`;

                prompt += `求测者的基本資訊如下：\n`;
                prompt += `性别：${gender}\n`;
                prompt += `出生年份：${year}年\n`;
                prompt += `生肖：${zodiac[lun.char8.year.branch.value]}\n`;
                // prompt += `星座：${astrolabe.sign}\n\n`;


                prompt += `其八字命盤如下：\n`;
                prompt += `年柱：${lun.char8.year.toString()}(${lun.year.stemTenGod.name}) 柱纳音：${lun.year.takeSound} 五行：${lun.char8.year.stem.e5.name + lun.char8.year.branch.e5.name}\n`;
                prompt += `月柱：${lun.char8.month.toString()}(${lun.month.stemTenGod.name}) 柱纳音：${lun.month.takeSound} 五行：${lun.char8.month.stem.e5.name + lun.char8.month.branch.e5.name}\n`;
                prompt += `日柱：${lun.char8.day.toString()}(${lun.day.stemTenGod.name}) 柱纳音：${lun.day.takeSound} 五行：${lun.char8.day.stem.e5.name + lun.char8.day.branch.e5.name}\n`;
                prompt += `時柱：${lun.char8.hour.toString()}(${lun.hour.stemTenGod.name}) 柱纳音：${lun.hour.takeSound} 五行：${lun.char8.hour.stem.e5.name + lun.char8.hour.branch.e5.name}\n`;
                prompt += `五行：金(${elements['金']})、木(${elements['木']})、水(${elements['水']})、火(${elements['火']})、土(${elements['土']})\n\n`;


                prompt += `大運信息：從${bigLuck.startYear}年起運，運程順序為：${bigLuck.dayun.join('、')}\n\n`;

                prompt += `請你從以下幾個方面入手，展開你的分析：\n\n`;

                prompt += `1.整體審視命局：首先，請你對整個八字命盤進行審視，從五行、陰陽、十神、格局等多個角度入手，對命局的整體特點進行概括性的描述。例如，五行是否均衡？陰陽是否協調？是否存在某種特殊的格局？日元得令、得地、得助嗎？\n\n`;

                prompt += `2.分析日元強弱：日元代表命主自身，其強弱直接關系到命主的運勢。請你結合月令、地支、天幹等因素，綜合判斷日元的強弱，並說明判斷的依據。如果日元偏強，喜什麽？忌什麽？如果日元偏弱，又該如何取用神？\n\n`;

                prompt += `3.剖析性格特征：性格決定命運。請你結合八字命盤，分析命主的性格特點、優缺點，以及可能的發展方向。例如，是積極進取還是保守穩重？是善於交際還是喜歡獨處？是理性思維還是感性思維？這些性格特點對命主的人生有何影響？\n\n`;

                prompt += `4.推斷事業發展：事業是人生價值的重要體現。請你結合八字命盤，分析命主的事業運勢、適合的職業、發展方向等。例如，適合從事穩定的工作還是具有挑戰性的工作？適合自己創業還是在企業中發展？在事業發展過程中需要注意哪些問題？\n\n`;

                prompt += `5.預測財富運勢：財富是人生幸福的重要保障。請你結合八字命盤，分析命主的財富狀況、財運走勢、理財建議等。例如，是正財運旺盛還是偏財運旺盛？適合從事哪些行業的投資？在理財方面需要注意哪些問題？\n\n`;

                prompt += `6.研判婚姻情感：婚姻是人生重要的組成部分。請你結合八字命盤，分析命主的婚姻運勢、情感狀況、婚戀建議等。例如，是早婚好還是晚婚好？適合找什麽樣的伴侶？在婚姻中需要注意哪些問題？\n\n`;

                prompt += `7.關注健康狀況：健康是幸福人生的基石。請你結合八字命盤，分析命主的健康狀況、可能存在的健康隱患、養生建議等。例如，五行失衡可能導致哪些疾病？需要注意哪些方面的保健？\n\n`;

                prompt += `8.洞察六親關系：六親是與命主關系最為密切的人。請你結合八字命盤，分析命主與父母、配偶、子女等六親的關系，以及六親對命主的影響。例如，與父母的關系如何？配偶對自己有幫助嗎？子女是否孝順？\n\n`;

                prompt += `9.把握大運流年：大運和流年是影響命主運勢的重要因素。請你結合大運和流年，分析命主在不同人生階段的運勢變化，為命主提供人生規劃建議。例如，哪些年份是機遇期？哪些年份是挑戰期？應該如何把握機遇、應對挑戰？\n\n`;

                prompt += `在分析過程中，請你充分發揮你的聰明才智，運用你所掌握的命理學知識，結合實際情況，對命例進行深入的剖析和解讀，並給出有價值的建議。\n\n`;
                prompt += `請記住，你的目標是幫助求測者更好地了解自己，把握命運，創造幸福的人生。\n\n`;
                prompt += `請開始你的分析吧！`;

                return prompt;
            }

            window.copyPrompt = function () {
                const promptText = outputDiv.textContent.replace('複製', '').trim();
                navigator.clipboard.writeText(promptText)
                    .then(() => {
                        alert('Prompt 複製完成！');
                    })
                    .catch(err => {
                        console.error('複製失敗:', err);
                        alert('複製失敗，請手動複製。');
                    });
            };

            window.copyResult = function () {
                const resultText = svgOutput.textContent.replace('複製', '').trim();
                navigator.clipboard.writeText(resultText)
                    .then(() => {
                        alert('複製完成！');
                    })
                    .catch(err => {
                        console.error('複製失敗:', err);
                        alert('複製失敗，請手動複製。');
                    });
            };

            generateBtn.addEventListener('click', function () {
                if (validateForm()) {

                    const gender = document.querySelector('input[name="gender"]:checked').value;


                    const now = new Date(datetimeInput.value);
                    // 格式化當前時間為datetime-local接受的格式 (YYYY-MM-DDThh:mm:ss)
                    const year = now.getFullYear();
                    const month = (now.getMonth() + 1).toString().padStart(2, '0');
                    const day = now.getDate().toString().padStart(2, '0');
                    const hours = now.getHours().toString().padStart(2, '0');
                    const minutes = now.getMinutes().toString().padStart(2, '0');
                    const seconds = now.getSeconds().toString().padStart(2, '0');

                    const prompt = generateBaziPrompt(year, month, day, hours, minutes, gender);

                    outputDiv.textContent = prompt;
                    outputDiv.innerHTML = `<button class="copy-btn" onclick="copyPrompt()">複製</button>` + `<br>` + prompt;

                    fetchResult(prompt);
                }
            });

            const apiUrl = "https://europe-west3-durable-pulsar-384402.cloudfunctions.net/ai"

            const loadingOverlay = document.querySelector('.loading-overlay');

            async function fetchResult(prompt) {
                loadingOverlay.style.display = 'flex';

                const apiBody = {
                    "userId": '0_cyber8',
                    "text": prompt,
                    "type": "text",
                }
                try {
                    const response = await fetch(`${apiUrl}?type=8z`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(apiBody)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    svgOutput.innerHTML = `<button class="copy-btn" onclick="copyResult()">複製</button></br>` + marked.parse(data.msg.trim());

                } catch (error) {
                    console.error('API請求失敗:', error);
                } finally {
                    loadingOverlay.style.display = 'none';
                }
            }

            initializeSelectors();
        });
    </script>
</body>

</html>