<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>賽博算命</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/iztro/dist/iztro.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            padding: 0;
            background-color: #f4f4f4;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        input[type="number"],
        input[type="time"],
        select,
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .date-group {
            display: flex;
            gap: 10px;
        }

        .date-group input {
            width: 33%;
        }

        .radio-group {
            display: flex;
            gap: 20px;
        }

        .radio-group label {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        input[type="radio"] {
            margin: 0;
        }

        #generate-btn {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
        }

        #generate-btn:hover {
            background-color: #0056b3;
        }

        #error-message {
            color: red;
            margin-top: 10px;
            display: none;
        }

        pre {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            position: relative;
        }

        .form-section {
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }

        .form-section:last-child {
            border-bottom: none;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .copy-btn:hover {
            background-color: #0056b3;
        }

        #svgOutput {
            border: 1px solid #ddd;
            padding: 15px;
            line-height: 1.6;
        }

        #svgOutput code {
            background-color: #f5f5f5;
            padding: 2px 4px;
            border-radius: 4px;
            font-family: monospace;
        }

        #svgOutput pre {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }

        #svgOutput pre code {
            background-color: transparent;
            padding: 0;
        }

        #svgOutput blockquote {
            border-left: 4px solid #ddd;
            padding-left: 15px;
            margin-left: 0;
            color: #666;
        }

        #svgOutput h1,
        #svgOutput h2,
        #svgOutput h3,
        #svgOutput h4 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
        }

        #svgOutput ul,
        #svgOutput ol {
            padding-left: 20px;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .progress-bar {
            width: 80%;
            max-width: 500px;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar-inner {
            width: 100%;
            height: 100%;
            background-color: #4CAF50;
            animation: progress 2s infinite linear;
            transform-origin: left;
        }

        @keyframes progress {
            0% {
                transform: scaleX(0);
            }

            50% {
                transform: scaleX(1);
            }

            100% {
                transform: scaleX(0);
            }
        }
    </style>
</head>

<body>
    <div class="loading-overlay">
        <div class="progress-bar">
            <div class="progress-bar-inner"></div>
        </div>
    </div>
    <div class="container">
        <h1>賽博八字綜合分析Prompt生成器</h1>

        <div class="form-section">
            <label>出生日期 (西元):</label>
            <div class="date-group">
                <input type="datetime-local" id="datetime" step="1">
            </div>
        </div>

        <div class="form-section">
            <label>性別:</label>
            <div class="radio-group">
                <label><input type="radio" name="gender" value="男" required> 男</label>
                <label><input type="radio" name="gender" value="女" required> 女</label>
            </div>
        </div>

        <button id="generate-btn">請幫我算一算！</button>
        <div id="error-message"></div>
        <h2>結果:</h2>
        <div id="svgOutput"></div>

        <pre id="output">
            <button class="copy-btn" onclick="copyPrompt()">Copy</button>
        </pre>

    </div>

    <script>


        document.addEventListener('DOMContentLoaded', function () {
            const datetimeInput = document.getElementById('datetime');

            const genderRadios = document.getElementsByName('gender');
            const generateBtn = document.getElementById('generate-btn');
            const errorMessage = document.getElementById('error-message');
            const outputDiv = document.getElementById('output');
            const svgOutput = document.getElementById('svgOutput');

            function initializeSelectors() {
                const now = new Date('2000-01-01T13:00:00');
                // 格式化當前時間為datetime-local接受的格式 (YYYY-MM-DDThh:mm:ss)
                const year = now.getFullYear();
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const seconds = now.getSeconds().toString().padStart(2, '0');
                datetimeInput.value = `${year}-${month}-${day}T${hours}:${minutes}:${seconds}`;
            }

            function validateForm() {
                errorMessage.style.display = 'none';
                errorMessage.textContent = '';
                let isValid = true;

                if (!Array.from(genderRadios).some(radio => radio.checked)) {
                    errorMessage.textContent += "請選擇性別。";
                    isValid = false;
                }

                if (!isValid) {
                    errorMessage.style.display = 'block';
                }
                return isValid;
            }



            function generateBaziPrompt(year, month, day, hours, minutes, gender) {

                var astrolabe = iztro.astro.bySolar(`${year}-${month}-${day} ${hours}:${minutes}:00`, 2, gender ? '男' : '女', true, 'zh-TW');

                console.log(astrolabe);

                const chineseDate = astrolabe.chineseDate.split(' ');

                let prompt = "";
                prompt += `你是一位對中國傳統八字命理學有著深刻理解和豐富經驗的專家。你精通《滴天髓》、《子平真詮》、《窮通寶鑒》等經典著作，擅長運用五行生克、十神意象、格局喜忌等理論，對人生命運進行分析和解讀。\n\n`;
                prompt += `現在你將面對一個八字命例，請你運用你的專業知識和經驗，對該命例進行全面、深入的分析，並給出有價值的建議。請你務必逐步思考、推理，並清晰地展示你的思考過程。\n\n`;

                prompt += `求测者的基本資訊如下：\n`;
                prompt += `性别：${gender}\n`;
                prompt += `出生年份：${year}年\n\n`;
                prompt += `生肖：${astrolabe.zodiac}\n`;
                prompt += `星座：${astrolabe.sign}\n\n`;


                prompt += `其八字命盘如下：\n`;
                prompt += `年柱：${chineseDate[0]}\n`;
                prompt += `月柱：${chineseDate[1]}\n`;
                prompt += `日柱：${chineseDate[2]}\n`;
                prompt += `时柱：${chineseDate[3]}\n\n`;
                prompt += `五行局：${astrolabe.fiveElementsClass}\n\n`;


                // prompt += `大运信息：从${bigLuck.startYear}年起运，运程顺序为：${bigLuck.dayun.join('、')}\n\n`;

                prompt += `請你從以下幾個方面入手，展開你的分析：\n\n`;

                prompt += `1.整體審視命局：首先，請你對整個八字命盤進行審視，從五行、陰陽、十神、格局等多個角度入手，對命局的整體特點進行概括性的描述。例如，五行是否均衡？陰陽是否協調？是否存在某種特殊的格局？日元得令、得地、得助嗎？\n\n`;

                prompt += `2.分析日元強弱：日元代表命主自身，其強弱直接關系到命主的運勢。請你結合月令、地支、天幹等因素，綜合判斷日元的強弱，並說明判斷的依據。如果日元偏強，喜什麽？忌什麽？如果日元偏弱，又該如何取用神？\n\n`;

                prompt += `3.剖析性格特征：性格決定命運。請你結合八字命盤，分析命主的性格特點、優缺點，以及可能的發展方向。例如，是積極進取還是保守穩重？是善於交際還是喜歡獨處？是理性思維還是感性思維？這些性格特點對命主的人生有何影響？\n\n`;

                prompt += `4.推斷事業發展：事業是人生價值的重要體現。請你結合八字命盤，分析命主的事業運勢、適合的職業、發展方向等。例如，適合從事穩定的工作還是具有挑戰性的工作？適合自己創業還是在企業中發展？在事業發展過程中需要注意哪些問題？\n\n`;

                prompt += `5.預測財富運勢：財富是人生幸福的重要保障。請你結合八字命盤，分析命主的財富狀況、財運走勢、理財建議等。例如，是正財運旺盛還是偏財運旺盛？適合從事哪些行業的投資？在理財方面需要注意哪些問題？\n\n`;

                prompt += `6.研判婚姻情感：婚姻是人生重要的組成部分。請你結合八字命盤，分析命主的婚姻運勢、情感狀況、婚戀建議等。例如，是早婚好還是晚婚好？適合找什麽樣的伴侶？在婚姻中需要注意哪些問題？\n\n`;

                prompt += `7.關注健康狀況：健康是幸福人生的基石。請你結合八字命盤，分析命主的健康狀況、可能存在的健康隱患、養生建議等。例如，五行失衡可能導致哪些疾病？需要注意哪些方面的保健？\n\n`;

                prompt += `8.洞察六親關系：六親是與命主關系最為密切的人。請你結合八字命盤，分析命主與父母、配偶、子女等六親的關系，以及六親對命主的影響。例如，與父母的關系如何？配偶對自己有幫助嗎？子女是否孝順？\n\n`;

                prompt += `9.把握大運流年：大運和流年是影響命主運勢的重要因素。請你結合大運和流年，分析命主在不同人生階段的運勢變化，為命主提供人生規劃建議。例如，哪些年份是機遇期？哪些年份是挑戰期？應該如何把握機遇、應對挑戰？\n\n`;

                prompt += `在分析過程中，請你充分發揮你的聰明才智，運用你所掌握的命理學知識，結合實際情況，對命例進行深入的剖析和解讀，並給出有價值的建議。\n\n`;
                prompt += `請記住，你的目標是幫助求測者更好地了解自己，把握命運，創造幸福的人生。\n\n`;
                prompt += `請開始你的分析吧！`;

                return prompt;
            }

            window.copyPrompt = function () {
                const promptText = outputDiv.textContent.replace('Copy', '').trim();
                navigator.clipboard.writeText(promptText)
                    .then(() => {
                        alert('Prompt 複製完成！');
                    })
                    .catch(err => {
                        console.error('複製失敗:', err);
                        alert('複製失敗，請手動複製。');
                    });
            };

            generateBtn.addEventListener('click', function () {
                if (validateForm()) {

                    const gender = document.querySelector('input[name="gender"]:checked').value;


                    const now = new Date(datetimeInput.value);
                    // 格式化當前時間為datetime-local接受的格式 (YYYY-MM-DDThh:mm:ss)
                    const year = now.getFullYear();
                    const month = (now.getMonth() + 1).toString().padStart(2, '0');
                    const day = now.getDate().toString().padStart(2, '0');
                    const hours = now.getHours().toString().padStart(2, '0');
                    const minutes = now.getMinutes().toString().padStart(2, '0');
                    const seconds = now.getSeconds().toString().padStart(2, '0');

                    const prompt = generateBaziPrompt(year, month, day, hours, minutes, gender);

                    outputDiv.textContent = prompt;
                    outputDiv.innerHTML = `<button class="copy-btn" onclick="copyPrompt()">複製</button>` + `<br>` + prompt;

                    fetchResult(prompt);
                }
            });

            const apiUrl = "https://europe-west3-durable-pulsar-384402.cloudfunctions.net/ai"

            const loadingOverlay = document.querySelector('.loading-overlay');

            async function fetchResult(prompt) {
                loadingOverlay.style.display = 'flex';

                // const fakeResponse = {
                //     "msg": "好的，我將按照您提供的框架，對這個八字命例進行深入分析，並提供有價值的建議。\n\n**1. 整體審視命局：**\n\n*   **五行：** 命局中，水（日元癸水）弱，木（甲木傷官）較弱，火（午火、巳火、丁火）旺，土（戊土、未土）中等。金缺。五行不均衡，缺金是最大的問題。\n*   **陰陽：** 陰陽相對平衡，但陽氣偏旺，略顯燥熱。\n*   **十神：** 傷官（甲木）透年，正官（戊土）透月，偏財（丁火）透時。傷官見官，但有財星化解，構成“傷官生財，財生官”的組合，但也暗藏官司是非的風險。\n*   **格局：** 正官格，但傷官透出，破格。需用財星化解，構成“傷官生財，財生官”的組合，格局層次有所提升，但也複雜。\n*   **日元：** 癸水日元生於午月，不得令。自坐未土，受克。年柱甲子，有子水幫扶，但力量有限。時支巳火耗洩。綜合來看，日元偏弱。\n\n**2. 分析日元強弱：**\n\n日元癸水，生於午月火旺之時，不得令；地支未土克身，巳火耗身。雖有年支子水幫扶，但遠水難救近火，且子水被年幹甲木洩氣。因此，綜合判斷，日元癸水偏弱。\n\n*   **喜：** 金、水。金能生水，增強日元力量；水能直接幫扶日元。\n*   **忌：** 木、火、土。木洩日元之氣，火耗日元之氣，土剋日元。\n\n**3. 剖析性格特徵：**\n\n*   **優點：**\n    *   **聰明有才華：** 傷官透出，代表聰明、才華、口才好，有藝術天賦，思維活躍，有創新精神。\n    *   **積極進取：** 正官代表責任心、上進心，有管理能力，渴望得到認可。\n    *   **人緣好：** 偏財透出，為人慷慨大方，善於交際，人緣較好。\n*   **缺點：**\n    *   **叛逆任性：** 傷官見官，容易恃才傲物，不服管束，挑戰權威，容易與領導、長輩發生衝突。\n    *   **情緒波動大：** 傷官也代表情緒不穩定，容易衝動，做事欠考慮。\n    *   **好面子：** 正官過於看重名譽，容易活在別人的評價裡，給自己造成壓力。\n*   **發展方向：**\n    *   適合從事具有創造性、挑戰性的工作，如藝術設計、廣告傳媒、市場營銷等。\n    *   也可以從事管理類工作，但要注意控制情緒，處理好人際關係。\n    *   不適合從事過於穩定、缺乏變化的工作。\n\n**4. 推斷事業發展：**\n\n*   **事業運勢：**\n    *   早年事業發展較為波折，容易遇到阻礙和挑戰。\n    *   中年事業運勢有所提升，但仍需注意人際關係。\n    *   晚年事業較為穩定。\n*   **適合的職業：**\n    *   藝術設計、廣告傳媒、市場營銷、自由職業、技術行業。\n*   **發展方向：**\n    *   可以考慮自己創業，但要謹慎選擇合作伙伴，避免因人際關係問題導致失敗。\n    *   也可以在企業中發展，但要注意處理好與領導、同事的關係，避免因傷官見官而影響事業。\n*   **注意事項：**\n    *   控制情緒，避免衝動行事。\n    *   虛心學習，不斷提升自身能力。\n    *   搞好人際關係，建立良好的人脈。\n    *   不要過於追求完美，學會接受不完美。\n\n**5. 預測財富運勢：**\n\n*   **財富狀況：**\n    *   命局中有偏財，說明有意外之財的機會，但偏財也代表不穩定，容易大起大落。\n    *   正財不顯，說明透過穩定工作獲得的收入相對有限。\n*   **財運走勢：**\n    *   早年財運一般，容易破財。\n    *   中年財運有所提升，但仍需謹慎理財。\n    *   晚年財運較為穩定。\n*   **理財建議：**\n    *   不要盲目投資，要做足功課，瞭解風險。\n    *   不要貪圖小便宜，避免上當受騙。\n    *   可以適當進行一些風險較低的投資，如房地產、基金等。\n    *   要注意節儉，避免過度消費。\n\n**6. 研判婚姻情感：**\n\n*   **婚姻運勢：**\n    *   男命以正財為妻星，命局中正財不顯，婚姻運勢較為波折。\n    *   日坐七殺，婚姻宮不穩，容易發生爭吵、矛盾。\n    *   傷官見官，也容易因性格不合而影響婚姻。\n*   **情感狀況：**\n    *   異性緣不錯，但容易遇到爛桃花。\n    *   在感情方面比較挑剔，不容易找到合適的伴侶。\n    *   婚後容易與配偶發生爭吵，需要互相理解、包容。\n*   **婚戀建議：**\n    *   晚婚為宜，30歲之後結婚較為合適。\n    *   選擇性格互補、成熟穩重的伴侶。\n    *   婚後要多溝通交流，互相理解、包容。\n    *   避免因小事爭吵，影響感情。\n\n**7. 關注健康狀況：**\n\n*   **健康狀況：**\n    *   五行缺金，需要注意呼吸系統、肺部、免疫力方面的問題。\n    *   火旺土燥，容易上火、便秘。\n    *   水弱，需要注意腎臟、泌尿系統方面的問題。\n*   **可能存在的健康隱患：**\n    *   呼吸道疾病、肺部疾病、腎臟疾病、泌尿系統疾病、便秘。\n*   **養生建議：**\n    *   多吃白色食物，如銀耳、百合、梨等，滋陰潤肺。\n    *   多喝水，保持身體水分充足。\n    *   適當進行體育鍛煉，增強體質。\n    *   保持心情舒暢，避免情緒波動。\n\n**8. 洞察六親關係：**\n\n*   **與父母的關係：**\n    *   與父親關係較為緊張，容易發生衝突。\n    *   與母親關係較為親密，能得到母親的幫助。\n*   **與配偶的關係：**\n    *   配偶性格較為強勢，容易與自己發生爭吵。\n    *   配偶對自己有一定的幫助，但也會給自己帶來壓力。\n*   **與子女的關係：**\n    *   子女較為孝順，能給自己帶來安慰。\n    *   但子女也可能比較叛逆，需要耐心引導。\n\n**9. 把握大運流年：**\n\n*   **1988-1997 己未大運：** 七殺運，壓力較大，身體不好，不利學業。\n*   **1998-2007 庚申大運：** 印綬運，運勢有所好轉，利於學業，但仍需努力。\n*   **2008-2017 辛酉大運：** 印綬運，事業發展較為順利，但容易遇到競爭對手。\n*   **2018-2027 壬戌大運：** 比劫運，運勢平平，容易破財，需要謹慎理財。\n*   **2028-2037 癸亥大運：** 比劫運，運勢平平，容易破財，需要謹慎理財。\n*   **2038-2047 甲子大運：** 傷官運，運勢較為動盪，容易發生變化。\n*   **2048-2057 乙丑大運：** 七殺運，壓力較大，身體不好，不利事業。\n*   **2058-2067 丙寅大運：** 正財運，晚年生活較為穩定，但容易因財生事。\n*   **2068-2077 丁卯大運：** 偏財運，晚年生活較為豐富，但容易大起大落。\n*   **2078-2087 戊辰大運：** 正官運，晚年生活較為平淡，但容易生病。\n\n**人生規劃建議：**\n\n1.  **提升自我：** 不斷學習，提升自身能力，尤其是在專業技能方面。\n2.  **改善人際關係：** 虛心待人，與人為善，建立良好的人脈關係。\n3.  **理財規劃：** 謹慎理財，避免盲目投資，做好風險管理。\n4.  **婚姻經營：** 互相理解，互相包容，共同經營幸福的婚姻。\n5.  **健康管理：** 注意飲食，適當鍛鍊，保持身心健康。\n\n現在請您指示是否需要更深入的分析，或者調整分析的側重點。\n```json\n{ \n\"svg\": \"<svg width=\\\"400\\\" height=\\\"600\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n  <!-- Background -->\\n  <rect width=\\\"100%\\\" height=\\\"100%\\\" fill=\\\"#F0F0F0\\\"/>\\n\\n  <!-- Title -->\\n  <text x=\\\"50%\\\" y=\\\"50\\\" font-family=\\\"STKaiti\\\" font-size=\\\"24\\\" fill=\\\"#555\\\" text-anchor=\\\"middle\\\">賽博八字卡</text>\\n\\n  <!-- Separator Line -->\\n  <line x1=\\\"50\\\" y1=\\\"80\\\" x2=\\\"350\\\" y2=\\\"80\\\" stroke=\\\"#BBB\\\" stroke-width=\\\"1\\\"/>\\n\\n  <!-- User Input & Bazi -->\\n  <text x=\\\"50%\\\" y=\\\"120\\\" font-family=\\\"STKaiti\\\" font-size=\\\"16\\\" fill=\\\"#666\\\" text-anchor=\\\"middle\\\">男 1984 甲子 戊午 癸未 丁巳</text>\\n\\n  <!-- Separator Line -->\\n  <line x1=\\\"50\\\" y1=\\\"150\\\" x2=\\\"350\\\" y2=\\\"150\\\" stroke=\\\"#BBB\\\" stroke-width=\\\"1\\\"/>\\n\\n  <!-- Poem -->\\n  <text x=\\\"50%\\\" y=\\\"200\\\" font-family=\\\"STKaiti\\\" font-size=\\\"18\\\" fill=\\\"#777\\\" text-anchor=\\\"middle\\\">\\n    <tspan x=\\\"50%\\\" dy=\\\"0em\\\">傷官駕殺來</tspan>\\n    <tspan x=\\\"50%\\\" dy=\\\"1.2em\\\">午月火煉裁</tspan>\\n    <tspan x=\\\"50%\\\" dy=\\\"1.2em\\\">財星亦入局</tspan>\\n    <tspan x=\\\"50%\\\" dy=\\\"1.2em\\\">命運不由呆</tspan>\\n  </text>\\n\\n  <!-- Explanation -->\\n  <text x=\\\"50%\\\" y=\\\"300\\\" font-family=\\\"STKaiti\\\" font-size=\\\"14\\\" fill=\\\"#888\\\" text-anchor=\\\"middle\\\">才華橫溢，命途多舛</text>\\n\\n  <!-- Subtitle -->\\n  <text x=\\\"50%\\\" y=\\\"350\\\" font-family=\\\"STKaiti\\\" font-size=\\\"18\\\" fill=\\\"#555\\\" text-anchor=\\\"middle\\\">2025年流年</text>\\n\\n  <!-- 2025 Poem -->\\n  <text x=\\\"50%\\\" y=\\\"400\\\" font-family=\\\"STKaiti\\\" font-size=\\\"18\\\" fill=\\\"#777\\\" text-anchor=\\\"middle\\\">\\n    <tspan x=\\\"50%\\\" dy=\\\"0em\\\">乙巳入命宮</tspan>\\n    <tspan x=\\\"50%\\\" dy=\\\"1.2em\\\">財旺恐成空</tspan>\\n    <tspan x=\\\"50%\\\" dy=\\\"1.2em\\\">守成方為上</tspan>\\n    <tspan x=\\\"50%\\\" dy=\\\"1.2em\\\">妄動必遭兇</tspan>\\n  </text>\\n\\n  <!-- Summary -->\\n  <text x=\\\"50%\\\" y=\\\"500\\\" font-family=\\\"STKaiti\\\" font-size=\\\"16\\\" fill=\\\"#999\\\" text-anchor=\\\"middle\\\">財來財去，守靜常安。</text>\\n</svg>\",\n\"summary\": \"傷官駕殺，財旺身弱，守靜待時。\"\n}\n```",
                //     "finishReason": "stop"
                // }
                // const svgMatch = fakeResponse.msg.match(/<svg[^>]*>([\s\S]*?)<\/svg>/);
                // let result = svgMatch ? `<svg style="width:400px; height:600px">${svgMatch[1]}</svg>` : '';
                // console.log(result);
                // svgOutput.innerHTML = marked.parse(fakeResponse.msg.trim());
                // loadingOverlay.style.display = 'none';

                const apiBody = {
                    "userId": '0_cyber8',
                    "text": prompt,
                    "type": "text",
                }
                try {
                    const response = await fetch(`${apiUrl}?type=8z`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(apiBody)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    svgOutput.innerHTML = marked.parse(data.msg.trim());

                } catch (error) {
                    console.error('API請求失敗:', error);
                } finally {
                    loadingOverlay.style.display = 'none';
                }
            }

            initializeSelectors();
        });
    </script>
</body>

</html>